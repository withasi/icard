/*!
 * @fileOverview HTK (Hybrid Touch Kit)
 * @copyright (c) 2012, All rights reserved.
 *  
 * @author @si(<a href='mailto:withasi@gmail.com'>withasi@gmail.com</a>)
 * @version 1.1.1.20121206b
 *  
 * 当前版本说明：
 *     性能优化:资源精简，根据纯web版本特点，剔除和native端的不必要脚本、剔除xui
 *     性能优化:模板中引入脚本性能优化
 */
(function(){var a={ISDEBUG:true,PATH:(function(){var h="es.base.js";var g="";var k=new RegExp("(^|(.*?\\/))("+h+")(\\?|$)");var c=document.getElementsByTagName("script");for(var f=0,b=c.length;f<b;f++){var j=c[f].getAttribute("src");if(j){var e=j.match(k);if(e){g=e[1];break}}}return g}()),namespace:function(g,c){var b=g.split("."),e=0,f;if(g.indexOf(".")==0){e=1;c=c||a}c=c||window;for(;f=b[e++];){if(!c[f]){c[f]={}}c=c[f]}return c},extend:function(b,f,c){if(c===undefined){c=true}for(var e in f){if(c||!(e in b)){b[e]=f[e]}}return b},deepextend:function(b,e){for(var c in e){var f=e[c];if(b===f){continue}if(typeof f==="object"){b[c]=arguments.callee(b[c]||{},f)}else{b[c]=f}}return b},noConflict:(function(b){var c=window.es;return function(){a=c;return a}}())};window.es=a}());(function(){window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(z){window.setTimeout(z,1000/60)}})(),window.cancelRequestAnimationFrame=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout})();var x=(/webkit/i).test(navigator.appVersion)?"webkit":(/firefox/i).test(navigator.userAgent)?"Moz":"opera" in window?"O":"",y=(/android/gi).test(navigator.appVersion),w=/iphone/gi.test(navigator.appVersion),e=window.devicePixelRatio>=2,u=/ipad/gi.test(navigator.appVersion),k=w||u,o="WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix(),b="translate"+(o?"3d(":"("),l=o?",0)":")",v="ontouchstart" in window,g=x+"Transform" in document.documentElement.style,h=true,j="onorientationchange" in window?"orientationchange":"resize",a=v?"touchstart":"mousedown",p=v?"touchmove":"mousemove",f=v?"touchend":"mouseup",t=v?"touchcancel":"mouseup",q=x=="Moz"?"DOMMouseScroll":"mousewheel",n=v?"touchend":"click",s="hoverin",c="hoverout";es.vendor=x,es.isAndroid=y,es.isIPhone=w,es.isIPhone4=e,es.isIPad=u,es.isIDevice=k,es.has3d=o,es.trnOpen=b,es.trnClose=l,es.hasTouch=v,es.hasTransform=g,es.hasTransitionEnd=h,es.RESIZE_EV=j,es.START_EV=a,es.MOVE_EV=p,es.END_EV=f,es.CANCEL_EV=t,es.WHEEL_EV=q,es.TOUCH_EV=n,es.HOVERIN_EV=s,es.HOVEROUT_EV=c}());(function(g){var h=g.extend;var b=function(){var l=function(){if(arguments&&arguments[0]!=es.Class.isPrototype){this.initialize.apply(this,arguments)}};var k={};var o,j;for(var n=0,e=arguments.length;n<e;++n){if(typeof arguments[n]=="function"){if(n==0&&e>1){j=arguments[n].prototype.initialize;arguments[n].prototype.initialize=function(){};k=new arguments[n];if(j===undefined){delete arguments[n].prototype.initialize}else{arguments[n].prototype.initialize=j}}o=arguments[n].prototype}else{o=arguments[n]}h(k,o)}l.prototype=k;return l};b.isPrototype=function(){};b.create=function(){return function(){if(arguments&&arguments[0]!=es.Class.isPrototype){this.initialize.apply(this,arguments)}}};b.inherit=function(){var l=arguments[0];var n=new l(es.Class.isPrototype);for(var k=1,e=arguments.length;k<e;k++){if(typeof arguments[k]=="function"){var j=arguments[k];arguments[k]=new j(es.Class.isPrototype)}h(n,arguments[k])}return n};var a=(function(){var j,q,l,t=1,o=function(x,z,y){if(!y.$$guid){y.$$guid=t++}if(!x.events){x.events={}}var w=x.events[z];if(!w){w=x.events[z]={};if(x["on"+z]){w[0]=x["on"+z]}}};if(window.addEventListener){var k={mouseenter:"mouseover",mouseleave:"mouseout"};j=function(w,z,y){if(z in k){o(w,z,y);var x=w.events[z][y.$$guid]=function(A){var B=A.relatedTarget;if(!B||(w!=B&&!(w.compareDocumentPosition(B)&16))){y.call(this,A)}};w.addEventListener(k[z],x,false)}else{w.addEventListener(z,y,false)}};q=function(w,y,x){if(y in k){if(w.events&&w.events[y]){w.removeEventListener(k[y],w.events[y][x.$$guid],false);delete w.events[y][x.$$guid]}}else{w.removeEventListener(y,x,false)}}}else{j=function(w,y,x){o(w,y,x);w.events[y][x.$$guid]=x;w["on"+y]=s};q=function(w,y,x){if(w.events&&w.events[y]){delete w.events[y][x.$$guid]}};function s(){var y=true,z=e();var w=this.events[z.type];for(var x in w){this.$$handleEvent=w[x];if(this.$$handleEvent(z)===false){y=false}}return y}}function l(w,y,x){j(w,y,z);function z(){x(arguments[0]);q(w,y,z)}}function e(x){if(x){return x}x=window.event;x.pageX=x.clientX+n(x.srcElement);x.pageY=x.clientY+u(x.srcElement);x.target=x.srcElement;x.stopPropagation=v;x.preventDefault=p;var w={mouseout:x.toElement,mouseover:x.fromElement}[x.type];if(w){x.relatedTarget=w}return x}function v(){this.cancelBubble=true}function p(){this.returnValue=false}function u(w){var x=w?w.ownerDocument:document;return x.documentElement.scrollTop||x.body.scrollTop}function n(w){var x=w?w.ownerDocument:document;return x.documentElement.scrollLeft||x.body.scrollLeft}return{addEvent:j,removeEvent:q,one:l,fixEvent:e}})();var f=(function(){var e=1;return{addEvent:function(j,l,k){if(!k.$$$guid){k.$$$guid=e++}if(!j.cusevents){j.cusevents={}}if(!j.cusevents[l]){j.cusevents[l]={}}j.cusevents[l][k.$$$guid]=k},removeEvent:function(j,l,k){if(j.cusevents&&j.cusevents[l]){delete j.cusevents[l][k.$$$guid]}},fireEvent:function(l,o){if(!l.cusevents){return}var k=Array.prototype.slice.call(arguments,2),j=l.cusevents[o];for(var n in j){j[n].apply(l,k)}},clearEvent:function(k){if(!k.cusevents){return}for(var n in k.cusevents){var j=k.cusevents[n];for(var l in j){j[l]=null}k.cusevents[n]=null}k.cusevents=null},one:function(j,l,k){var n=function(){k();this.removeEvent(j,l,n)};this.addEvent(j,l,n)}}})();var c={camelize:function(e){return e.replace(/-([a-z])/ig,function(j,k){return k.toUpperCase()})},decamelize:function(e){return e.replace(/[A-Z]/g,function(j){return"-"+j.toLowerCase()})},bytesLength:function(l){var e=0;for(var j=0,k;k=l.charCodeAt(j++);){e+=k&65280?2:1}return e}};g.evt=a,g.ce=f,g.s=c,g.Class=b}(es));(function(a){if(!a.ISDEBUG){window.console={};console.log=function(b){return false};console.debug=function(b){return false};console.info=function(b){return false};console.warn=function(b){return false};console.error=function(b){return false}}}(es));(function(b){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");b.uuid=function(c,g){var j=a,f=[],e;g=g||j.length;if(c){for(e=0;e<c;e++){f[e]=j[0|Math.random()*g]}}else{var h;f[8]=f[13]=f[18]=f[23]="-";f[14]="4";for(e=0;e<36;e++){if(!f[e]){h=0|Math.random()*16;f[e]=j[(e==19)?(h&3)|8:h]}}}return f.join("")};b.uuidFast=function(){var h=a,f=new Array(36),e=0,g;for(var c=0;c<36;c++){if(c==8||c==13||c==18||c==23){f[c]="-"}else{if(c==14){f[c]="4"}else{if(e<=2){e=33554432+(Math.random()*16777216)|0}g=e&15;e=e>>4;f[c]=h[(c==19)?(g&3)|8:g]}}}return f.join("")};b.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){var f=Math.random()*16|0,e=g=="x"?f:(f&3|8);return e.toString(16)})}}(es));(function(){e$=function(){return new e$.fn.n()};e$.fn=e$.prototype={n:function(){return e$.fn},xhr:function(k,b,n){if(!/^(inner|outer|top|bottom|before|after)$/.test(k)){n=b;b=k;k="inner"}var e=n?n:{};if(typeof n=="function"){e={};e.callback=n}var h=this,j=new XMLHttpRequest(),a=e.method||"get",f=(typeof e.async!="undefined"?e.async:true),g=e.data||null,l;j.queryString=g;j.open(a,b,f);j.setRequestHeader("X-Requested-With","XMLHttpRequest");if(a.toLowerCase()=="post"){j.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}for(l in e.headers){if(e.headers.hasOwnProperty(l)){j.setRequestHeader(l,e.headers[l])}}j.handleResp=(e.callback!=null)?e.callback:function(){h.html(k,j.responseText)};j.handleError=(e.error&&typeof e.error=="function")?e.error:function(){};function c(){if(j.readyState==4){delete (h.xmlHttpRequest);if(j.status===0||j.status==200){j.handleResp()}if((/^[45]/).test(j.status)){j.handleError()}}}if(f){j.onreadystatechange=c;this.xmlHttpRequest=j}j.send(g);if(!f){c()}return this}}}());(function(x){var t=x.has3d,A=x.isAndroid,p=x.isIDevice,l=x.hasTransform,y=x.hasTouch,n=x.hasTransitionEnd,z=x.vendor,g=x.trnOpen,q=x.trnClose;var c=function(B,e){var C=this,D=document;C.wrapper=typeof B=="object"?B:D.getElementById(B);C.wrapper.style.overflow="hidden";C.scroller=C.wrapper.children[0];C.barShowDelay=0;C.momentumTim=0;C.momSThre=3;C.sThre=1.7;C.pg=0;C.itemIndex=0;C.options={hScroll:false,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:true,topOffset:0,checkDOMChanges:false,hScrollbar:false,vScrollbar:true,fixedScrollbar:A,hideScrollbar:true,fadeScrollbar:p&&t,scrollbarClass:"",snap:false,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(E){E.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,isInit:true,bFirstPullUp:true};f();for(i in e){C.options[i]=e[i]}C.x=C.options.x;C.y=C.options.y;C.options.useTransform=l?C.options.useTransform:false;C.options.hScrollbar=C.options.hScroll&&C.options.hScrollbar;C.options.vScrollbar=C.options.vScroll&&C.options.vScrollbar;C.options.useTransition=n&&C.options.useTransition;C.scroller.style[z+"TransitionProperty"]=C.options.useTransform?"-"+z.toLowerCase()+"-transform":"top left";C.scroller.style[z+"TransitionDuration"]="0";C.scroller.style[z+"TransformOrigin"]="0 0";if(C.options.useTransition){C.scroller.style[z+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)"}if(C.options.useTransform){C.scroller.style[z+"Transform"]=g+C.x+"px,"+C.y+"px"+q}else{C.scroller.style.cssText+=";position:absolute;top:"+C.y+"px;left:"+C.x+"px"}if(C.options.useTransition){C.options.fixedScrollbar=true}if(C.options.isInit){C.refresh()}};var f=function(){};c.prototype={enabled:true,x:0,y:0,steps:[],currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,moved:false,animating:false,scrollTo:function(e,H,G,F){G=G|0;var E=this,D=e,C,B;E.stop();if(!D.length){D=[{x:e,y:H,time:G,relative:F}]}for(C=0,B=D.length;C<B;C++){if(D[C].relative){D[C].x=E.x-D[C].x;D[C].y=E.y-D[C].y}E.steps.push({x:D[C].x,y:D[C].y,time:D[C].time||0})}E._startAni()},scrollToElement:function(e,C){var B=this,D;e=e.nodeType?e:B.scroller.querySelector(e);if(!e){return}D=B._offset(e);D.left+=B.wrapperOffsetLeft;D.top+=B.wrapperOffsetTop;D.left=D.left>0?0:D.left<B.maxScrollX?B.maxScrollX:D.left;D.top=D.top>B.minScrollY?B.minScrollY:D.top<B.maxScrollY?B.maxScrollY:D.top;C=C===undefined?Math.max(Math.abs(D.left)*2,Math.abs(D.top)*2):C;B.scrollTo(D.left,D.top,C)},posToElement:function(e){var B=this,C;e=e.nodeType?e:B.scroller.querySelector(e);if(!e){return}C=B._offset(e);C.left+=B.wrapperOffsetLeft;C.top+=B.wrapperOffsetTop;C.left=C.left>0?0:C.left<B.maxScrollX?B.maxScrollX:C.left;C.top=C.top>B.minScrollY?B.minScrollY:C.top<B.maxScrollY?B.maxScrollY:C.top;if(C.top>0){B._pos(C.left,0)}else{B._pos(C.left,C.top)}if(B.hScrollbar&&B.options.hideScrollbar){B.hScrollbarWrapper.style.opacity="0"}if(B.vScrollbar&&B.options.hideScrollbar){B.vScrollbarWrapper.style.opacity=0}},stop:function(){if(this.options.useTransition){this._unbind("webkitTransitionEnd")}else{window.cancelRequestAnimationFrame(this.aniTime)}this.steps=[];this.moved=false;this.animating=false},destroy:function(){var e=this;e.scroller.style[z+"Transform"]="";e.hScrollbar=false;e.vScrollbar=false;e._scrollbar("h");e._scrollbar("v");e._unbind(es.RESIZE_EV,window);e._unbind(es.START_EV);e._unbind(es.MOVE_EV);e._unbind(es.END_EV);e._unbind(es.CANCEL_EV);if(!e.options.hasTouch){e._unbind("mouseout",e.wrapper);e._unbind(es.WHEEL_EV)}if(e.options.useTransition){e._unbind("webkitTransitionEnd")}if(e.options.checkDOMChanges){clearInterval(e.checkDOMTime)}if(e.options.onDestroy){e.options.onDestroy.call(e)}},refresh:function(){var e=this,B;e.wrapperW=e.wrapper.clientWidth||1;e.wrapperH=e.wrapper.clientHeight||1;e.minScrollY=-e.options.topOffset||0;e.scrollerW=e.scroller.offsetWidth;e.scrollerH=e.scroller.offsetHeight+e.minScrollY;e.maxScrollX=e.wrapperW-e.scrollerW;e.maxScrollY=e.wrapperH-e.scrollerH+e.minScrollY;e.dirX=0;e.dirY=0;if(e.options.onRefresh){e.options.onRefresh.call(e)}e.bEnableVDrag=e.scrollerH>e.wrapperH;e.hScroll=e.options.hScroll&&e.maxScrollX<0;e.vScroll=e.options.vScroll&&(!e.options.bounceLock&&!e.hScroll||e.bEnableVDrag);e.hScrollbar=e.hScroll&&e.options.hScrollbar;e.vScrollbar=e.vScroll&&e.options.vScrollbar&&e.bEnableVDrag;B=e._offset(e.wrapper);e.wrapperOffsetLeft=-B.left;e.wrapperOffsetTop=-B.top;e._scrollbar("v");e.scroller.style[z+"TransitionDuration"]="0";e._resetPos(200)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},A?200:0)},_resetPos:function(D,C){var e=this,E=e.x>=0?0:e.x<e.maxScrollX?e.maxScrollX:e.x,B=e.y>=e.minScrollY||e.maxScrollY>0?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y;if(E==e.x&&B==e.y){if(e.moved){e.moved=false;if(!e.bScrollCancel){x.bEnableTouch=true;setTimeout(function(){if(e.options.onScrollEnd){e.options.onScrollEnd.call(e)}e.momentumTim=0},e.momentumTim+100)}}return}if(e.startY>=0&&e.y>0||e.startY<=e.maxScrollY&&e.y<=e.maxScrollY){e.scrollTo(E,B,D==0?200:D);if(D==0){setTimeout(function(){if(e.options.onScrollEnd){e.options.onScrollEnd.call(e)}},200)}}else{e._pos(E,B);if(C){setTimeout(function(){if(e.options.onScrollEnd){e.options.onScrollEnd.call(e)}e.momentumTim=0},e.momentumTim+100)}}},_pos:function(e,B){e=this.hScroll?e:0;B=this.vScroll?B:0;if(this.options.useTransform){this.scroller.style[z+"Transform"]=g+e+"px,"+B+"px"+q}else{e=Math.floor(e);B=Math.floor(B);this.scroller.style.left=e+"px";this.scroller.style.top=B+"px"}this.x=e;this.y=B;this._scrollbarPos("v")},_scrollbar:function(e){var C=this,D=document,B;if(!C[e+"Scrollbar"]){if(C[e+"ScrollbarWrapper"]){if(l){C[e+"ScrollbarIndicator"].style[z+"Transform"]=""}C[e+"ScrollbarWrapper"].parentNode.removeChild(C[e+"ScrollbarWrapper"]);C[e+"ScrollbarWrapper"]=null;C[e+"ScrollbarIndicator"]=null}return}if(!C[e+"ScrollbarWrapper"]){B=D.createElement("div");if(C.options.scrollbarClass){B.className=C.options.scrollbarClass+e.toUpperCase()}else{B.style.cssText="position:absolute;z-index:100;"+(e=="h"?"height:7px;bottom:1px;left:2px;right:"+(C.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(C.hScrollbar?"7":"2")+"px;top:2px;right:1px")}B.style.cssText+=";pointer-events:none;-"+z+"-transition-property:opacity;-"+z+"-transition-duration:"+(C.options.fadeScrollbar?"300ms":"0")+";overflow:hidden;opacity:"+(C.options.hideScrollbar?"0":"1");C.wrapper.appendChild(B);C[e+"ScrollbarWrapper"]=B;B=D.createElement("div");if(!C.options.scrollbarClass){B.style.cssText="position:absolute;z-index:100;background:rgb(160,160,160);border:1px solid rgba(255,255,255,0.9);-"+z+"-background-clip:padding-box;-"+z+"-box-sizing:border-box;"+(e=="h"?"height:100%":"width:100%")+";-"+z+"-border-radius:3px;border-radius:3px"}B.style.cssText+=";pointer-events:none;-"+z+"-transition-property:-"+z+"-transform;-"+z+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+z+"-transition-duration:0;-"+z+"-transform:"+g+"0,0"+q;if(C.options.useTransition){B.style.cssText+=";-"+z+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"}C[e+"ScrollbarWrapper"].appendChild(B);C[e+"ScrollbarIndicator"]=B}if(e=="h"){C.hScrollbarSize=C.hScrollbarWrapper.clientWidth;C.hScrollbarIndicatorSize=Math.max(Math.round(C.hScrollbarSize*C.hScrollbarSize/C.scrollerW),8);C.hScrollbarIndicator.style.width=C.hScrollbarIndicatorSize+"px";C.hScrollbarMaxScroll=C.hScrollbarSize-C.hScrollbarIndicatorSize;C.hScrollbarProp=C.hScrollbarMaxScroll/C.maxScrollX}else{C.vScrollbarSize=C.vScrollbarWrapper.clientHeight;C.vScrollbarIndicatorSize=Math.max(Math.round(C.vScrollbarSize*C.vScrollbarSize/C.scrollerH),8);C.vScrollbarIndicator.style.height=C.vScrollbarIndicatorSize+"px";C.vScrollbarMaxScroll=C.vScrollbarSize-C.vScrollbarIndicatorSize;C.vScrollbarProp=C.vScrollbarMaxScroll/C.maxScrollY}C._scrollbarPos(e,true)},_scrollbarPos:function(e,D){var C=this,E=e=="h"?C.x:C.y,B;if(!C[e+"Scrollbar"]){return}E=C[e+"ScrollbarProp"]*E;if(E<0){if(!C.options.fixedScrollbar){B=C[e+"ScrollbarIndicatorSize"]+Math.round(E*3);if(B<8){B=8}C[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=B+"px"}E=0}else{if(E>C[e+"ScrollbarMaxScroll"]){if(!C.options.fixedScrollbar){B=C[e+"ScrollbarIndicatorSize"]-Math.round((E-C[e+"ScrollbarMaxScroll"])*3);if(B<8){B=8}C[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=B+"px";E=C[e+"ScrollbarMaxScroll"]+(C[e+"ScrollbarIndicatorSize"]-B)}else{E=C[e+"ScrollbarMaxScroll"]}}}C[e+"ScrollbarWrapper"].style[z+"TransitionDelay"]=C.barShowDelay;C[e+"ScrollbarWrapper"].style.opacity=D&&C.options.hideScrollbar?"0":"1";C[e+"ScrollbarIndicator"].style[z+"Transform"]=g+(e=="h"?E+"px,0":"0,"+E+"px")+q},_transitionTime:function(e){this.scroller.style[z+"TransitionDuration"]=e;if(this.hScrollbar){this.hScrollbarIndicator.style[z+"TransitionDuration"]=e}if(this.vScrollbar){this.vScrollbarIndicator.style[z+"TransitionDuration"]=e}},_startAni:function(){var F=this,B=F.x,e=F.y,D=Date.now(),E,C;if(F.animating){return}if(!F.steps.length){F._resetPos(400);return}E=F.steps.shift();if(E.x==B&&E.y==e){E.time=0}F.animating=true;F.moved=true;if(F.options.useTransition){F._transitionTime(E.time+"ms");F._pos(E.x,E.y);F.animating=false;if(E.time){F._bind("webkitTransitionEnd");if(!F.bScrollCancel&&F.options.onScrollEnd&&F.endOneTim){x.bEnableTouch=true;setTimeout(function(){F.options.onScrollEnd.call(F)},F.endOneTim)}}else{F._resetPos(0)}return}C=function(I){var G=I||Date.now();if(A){if(Math.random()<0.4){var H=F._animateRePosHandler(G,D,B,e,E);if(H==1){return}}}else{var H=F._animateRePosHandler(G,D,B,e,E);if(H==1){return}}if(F.animating){F.aniTime=window.requestAnimFrame(C)}};C()},_animateRePosHandler:function(B,C,F,E,D){var G=this,e,I,H;if(B>=C+D.time){G._pos(D.x,D.y);G.animating=false;if(G.options.onAnimationEnd){G.options.onAnimationEnd.call(G)}G._startAni();return 1}B=(B-C)/D.time-1;H=Math.sqrt(1-B*B);e=(D.x-F)*H+F;I=(D.y-E)*H+E;G._pos(e,I)},_momentum:function(H,B,F,e,J){var G=0.0015,C=Math.abs(H)/B,D=(C*C)/(2*G),I,E=0;if(H>0&&D>F){E=J/(6/(D/C*G));F=F+E;C=C*F/D;D=F}else{if(H<0&&D>e){E=J/(6/(D/C*G));e=e+E;C=C*e/D;D=e}}D=D*(H<0?-1:1);I=C/G;this.momentumTim=I;return{dist:D,time:Math.floor(I)}},_offset:function(e){var C=-e.offsetLeft,B=-e.offsetTop;while(e=e.offsetParent){C-=e.offsetLeft;B-=e.offsetTop}return{left:C,top:B}},_snap:function(I,H){var F=this,E,D,G,C,B,e;G=F.pagesX.length-1;for(E=0,D=F.pagesX.length;E<D;E++){if(I>=F.pagesX[E]){G=E;break}}if(G==F.currPageX&&G>0&&F.dirX<0){G--}I=F.pagesX[G];B=Math.abs(I-F.pagesX[F.currPageX]);B=B?Math.abs(F.x-I)/B*500:0;F.currPageX=G;G=F.pagesY.length-1;for(E=0;E<G;E++){if(H>=F.pagesY[E]){G=E;break}}if(G==F.currPageY&&G>0&&F.dirY<0){G--}H=F.pagesY[G];e=Math.abs(H-F.pagesY[F.currPageY]);e=e?Math.abs(F.y-H)/e*500:0;F.currPageY=G;C=Math.floor(Math.max(B,e))||200;return{x:I,y:H,time:C}},_bind:function(C,B,e){(B||this.scroller).addEventListener(C,this,!!e)},_unbind:function(C,B,e){(B||this.scroller).removeEventListener(C,this,!!e)},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||(this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)){return}this.refresh()}};function j(F){var E=es.card;w(E);if(es.bEnableTouch&&!E.connecting&&(E.bEnableVDrag||E.pullUpEl||es.hasShowCatalogCard)){var C=es.hasTouch&&!es.useNativeEventLyr?F.touches[0]:F,D,B,H;if(!E.enabled){return}if(E.options.onBeforeScrollStart){E.options.onBeforeScrollStart.call(E,F)}if(E.options.useTransition||E.options.zoom){E._transitionTime(0)}E.moved=false;E.animating=false;E.distX=0;E.distY=0;E.absDistX=0;E.absDistY=0;E.dirX=0;E.dirY=0;if(E.options.momentum){if(E.options.useTransform){D=getComputedStyle(E.scroller,null)[es.vendor+"Transform"].replace(/[^0-9-.,]/g,"").split(",");B=D[4]*1;H=D[5]*1}else{B=getComputedStyle(E.scroller,null).left.replace(/[^0-9-]/g,"")*1;H=getComputedStyle(E.scroller,null).top.replace(/[^0-9-]/g,"")*1}if(B!=E.x||H!=E.y){if(E.options.useTransition){E._unbind("webkitTransitionEnd")}else{window.cancelRequestAnimationFrame(E.aniTime)}E.steps=[];E._pos(B,H)}}E.absStartX=E.x;E.absStartY=E.y;E.startX=E.x;E.startY=E.y;E.pointX=C.pageX;E.pointY=C.pageY;E.startTime=F.timeStamp||Date.now();if(E.options.onScrollStart){E.options.onScrollStart.call(E,F)}var G=es.touchEvtDiv;G.addEventListener(es.MOVE_EV,v);G.addEventListener(es.END_EV,h);G.addEventListener(es.CANCEL_EV,h)}}function v(F){if(es.vDirectionLock||es.hasShowCatalogCard){var E=es.card,J=es.hasTouch?F.touches[0]:F,D=J.pageX-E.pointX,C=J.pageY-E.pointY,B=E.x+D,K=E.y+C,G=F.timeStamp||Date.now();if(E.options.onBeforeScrollMove){E.options.onBeforeScrollMove.call(E,F)}E.pointX=J.pageX;E.pointY=J.pageY;if(B>0||B<E.maxScrollX){B=E.options.bounce?E.x+(D/2):B>=0||E.maxScrollX>=0?0:E.maxScrollX}if(K>E.minScrollY||K<E.maxScrollY){K=E.options.bounce?E.y+(C/2):K>=E.minScrollY||E.maxScrollY>=0?E.minScrollY:E.maxScrollY}E.distX+=D;E.distY+=C;E.absDistX=Math.abs(E.distX);E.absDistY=Math.abs(E.distY);if(E.absDistX<6&&E.absDistY<6){return}if(E.options.lockDirection){if(E.absDistX>E.absDistY+5){K=E.y;C=0}else{if(E.absDistY>E.absDistX+5){B=E.x;D=0}}}E.moved=true;if(es.bRollUnusethreshold||Math.abs(C)>es.tmThreshold){E._pos(B,K)}else{if(A){var I=B,H=K;I=E.hScroll?I:0;H=E.vScroll?H:0;E.x=I;E.y=H}else{E._pos(B,K)}}E.dirX=D>0?-1:D<0?1:0;E.dirY=C>0?-1:C<0?1:0;if(G-E.startTime>300){E.startTime=G;E.startX=E.x;E.startY=E.y}if(E.options.onScrollMove){E.options.onScrollMove.call(E,F)}}}function h(L,G,Q,I){if(es.hasTouch&&L.touches.length!=0){console.log("touch end bug");return}L=es.hasTouch?L.changedTouches[0]:L;var J=es.card,P=L,M,O,D={dist:0,time:0},B={dist:0,time:0},H=(L.timeStamp||Date.now())-J.startTime,N=J.x,K=J.y,C;var F=es.touchEvtDiv;F.removeEventListener(es.MOVE_EV,v);F.removeEventListener(es.END_EV,h);F.removeEventListener(es.CANCEL_EV,h);if(J.options.onBeforeScrollEnd){J.options.onBeforeScrollEnd.call(J,L)}if(!J.moved){if(y){J.doubleTapTimer=setTimeout(function(){J.doubleTapTimer=null;M=P.target;while(M.nodeType!=1){M=M.parentNode}if(M.tagName!="SELECT"&&M.tagName!="INPUT"&&M.tagName!="TEXTAREA"){O=document.createEvent("MouseEvents");O.initMouseEvent("click",true,true,L.view,1,P.screenX,P.screenY,P.clientX,P.clientY,L.ctrlKey,L.altKey,L.shiftKey,L.metaKey,0,null);O._fake=true;M.dispatchEvent(O)}},0)}J._resetPos(200);if(J.options.onTouchEnd){J.options.onTouchEnd.call(J,L)}return}if(G&&Q){J.endOneTim=Q;var E=G*Q;if(I==1003){E=J.y-E;if(E<J.maxScrollY){E=J.maxScrollY}}else{if(I==1004){E=J.y+E;if(E>0){E=0}}}J.scrollTo(J.x,E,Q);if(J.options.onTouchEnd){J.options.onTouchEnd.call(J,L)}return}if(H<300&&J.options.momentum){D=N?J._momentum(N-J.startX,H,-J.x,J.scrollerW-J.wrapperW+J.x,J.options.bounce?J.wrapperW:0):D;B=K?J._momentum(K-J.startY,H,-J.y,(J.maxScrollY<0?J.scrollerH-J.wrapperH+J.y-J.minScrollY:0),J.options.bounce?J.wrapperH:0):B;N=J.x+D.dist;K=J.y+B.dist;if((J.x>0&&N>0)||(J.x<J.maxScrollX&&N<J.maxScrollX)){D={dist:0,time:0}}if((J.y>J.minScrollY&&K>J.minScrollY)||(J.y<J.maxScrollY&&K<J.maxScrollY)){B={dist:0,time:0}}}if(D.dist||B.dist){C=Math.max(Math.max(D.time,B.time),10);J.scrollTo(Math.floor(N),Math.floor(K),C);if(J.options.onTouchEnd){J.options.onTouchEnd.call(J,L)}return}J._resetPos(200);if(J.options.onTouchEnd){J.options.onTouchEnd.call(J,L)}}function w(e){if(A){e.barShowDelay="100ms";setTimeout(function(){e.barShowDelay=0},100)}}function s(F){var E=es.card;w(E);if(es.bEnableTouch&&!E.connecting&&(E.bEnableVDrag||E.pullUpEl||es.hasShowCatalogCard)){var C=es.hasTouch&&!es.useNativeEventLyr?F.touches[0]:F,D,B,H;if(!E.enabled){return}if(E.options.onBeforeScrollStart){E.options.onBeforeScrollStart.call(E,F)}if(E.options.useTransition||E.options.zoom){E._transitionTime(0)}E.moved=false;E.animating=false;E.distX=0;E.distY=0;E.absDistX=0;E.absDistY=0;E.dirX=0;E.dirY=0;if(E.options.momentum){if(E.options.useTransform){D=getComputedStyle(E.scroller,null)[es.vendor+"Transform"].replace(/[^0-9-.,]/g,"").split(",");B=D[4]*1;H=D[5]*1}else{B=getComputedStyle(E.scroller,null).left.replace(/[^0-9-]/g,"")*1;H=getComputedStyle(E.scroller,null).top.replace(/[^0-9-]/g,"")*1}if(B!=E.x||H!=E.y){if(E.options.useTransition){E._unbind("webkitTransitionEnd")}else{window.cancelRequestAnimationFrame(E.aniTime)}E.steps=[];E._pos(B,H)}}E.absStartX=E.x;E.absStartY=E.y;E.startX=E.x;E.startY=E.y;E.pointX=C.pageX;E.pointY=C.pageY;E.startTime=F.timeStamp||Date.now();if(E.options.onScrollStart){E.options.onScrollStart.call(E,F)}if(!A){var G=es.touchEvtDiv;G.addEventListener(es.MOVE_EV,v);G.addEventListener(es.END_EV,b);G.addEventListener(es.CANCEL_EV,b)}}}function b(){var e=es.card;var B=es.touchEvtDiv;B.removeEventListener(es.MOVE_EV,v);B.removeEventListener(es.END_EV,b);B.removeEventListener(es.CANCEL_EV,b);e._resetPos(e.endOneTim|0,true)}function o(H,F){var G=es.card;if(es.bPageTpl){var E=es.cardInnerHeight+12,C=0,D=parseInt(es.cardHeight/H.speed);if(F==1){if(G.y<=G.maxScrollY){G.scrollTo(0,G.y-100,300);setTimeout(function(){G.scrollTo(0,G.maxScrollY,300);setTimeout(function(){if(G.options.onScrollEnd){G.options.onScrollEnd.call(G)}},300)},300)}else{G.pg++;G.scrollTo(0,G.y-E,D);setTimeout(function(){if(G.options.onScrollEnd){G.options.onScrollEnd.call(G)}},D)}}else{if(G.y>=0){G.scrollTo(0,G.y+100,300);setTimeout(function(){G.scrollTo(0,0,300);setTimeout(function(){if(G.options.onScrollEnd){G.options.onScrollEnd.call(G)}},300)},300)}else{G.pg--;G.scrollTo(0,G.y+E,D);setTimeout(function(){if(G.options.onScrollEnd){G.options.onScrollEnd.call(G)}},D)}}es.bEnableTouch=true;return}else{var E=es.cardHeight-Math.abs(H.distanceY)-10,C=es.scrollReboundDis,D=parseInt(es.cardHeight/H.speed)}if(H.speed>G.sThre&&Math.abs(G.y-G.startY)>100){G.endOneTim=false;if(A){G.moved=true;h(window.event,H.speed,700,H.direct);return}h(window.event);return}es.bEnableTouch=false;if(A){E=es.cardHeight-C}D=D>1200?1200:D;G.endOneTim=D;if(F==1){var B=G.y-E;C=-C;if(B<=G.maxScrollY){D=D>300?300:D;G.endOneTim=D;G.scrollTo(0,G.maxScrollY,D);return}}else{var B=G.y+E;if(B>=0){D=D>500?500:D;G.endOneTim=D;G.scrollTo(0,0,D);return}}if(A){G.scrollTo(0,B-C,D)}else{G.bScrollCancel=true;G.scrollTo(0,B,D);if(G.options.useTransition){setTimeout(function(){G.bScrollCancel=false;G.scrollTo(0,B-C,180)},D+150)}else{setTimeout(function(){G.bScrollCancel=false;G.scrollTo(0,B-C,200)},D+50)}}}function k(G){var F=es.card;if(es.bEnableTouch&&!F.connecting&&(F.bEnableVDrag||F.pullUpEl||es.hasShowCatalogCard)){var D=es.hasTouch&&!es.useNativeEventLyr?G.touches[0]:G,E,C,I;if(!F.enabled){return}if(F.options.onBeforeScrollStart){F.options.onBeforeScrollStart.call(F,G)}if(F.options.useTransition||F.options.zoom){F._transitionTime(0)}F.moved=false;F.animating=false;F.distX=0;F.distY=0;F.absDistX=0;F.absDistY=0;F.dirX=0;F.dirY=0;if(F.options.momentum){if(F.options.useTransform){E=getComputedStyle(F.scroller,null)[es.vendor+"Transform"].replace(/[^0-9-.,]/g,"").split(",");C=E[4]*1;I=E[5]*1}else{C=getComputedStyle(F.scroller,null).left.replace(/[^0-9-]/g,"")*1;I=getComputedStyle(F.scroller,null).top.replace(/[^0-9-]/g,"")*1}if(C!=F.x||I!=F.y){if(F.options.useTransition){F._unbind("webkitTransitionEnd")}else{window.cancelRequestAnimationFrame(F.aniTime)}F.steps=[];F._pos(C,I)}}F.absStartX=F.x;F.absStartY=F.y;F.startX=F.x;F.startY=F.y;F.pointX=D.pageX/window.devicePixelRatio;F.pointY=D.pageY/window.devicePixelRatio;F.startTime=G.timeStamp||Date.now();if(F.options.onScrollStart){F.options.onScrollStart.call(F,G)}if(F.vScrollbarWrapper){var H=es.touchEvtDiv?es.touchEvtDiv:document.getElementById("touchevent");H.addEventListener("up",u);es.startCardFlag=true;es._tt1=new Date;function B(e){var J=JSON.parse(es_toucheventgetvar.getPos());if(e){es.timeF1=null;es.x1=es.lx1=J.posx;es.y1=es.ly1=J.posy}else{es.x1=J.posx;es.y1=J.posy;if(Math.abs(es.y1-es.ly1)>es.cardWidth/100){a({pageX:J.posx,pageY:J.posy,time:(new Date-es._tt1)});es.lx1=J.posx;es.ly1=J.posy}}if(es.startCardFlag){es.timeF1=setTimeout(B,50)}else{clearTimeout(es.timeF1)}}B(true)}}}function a(H){if(es.vDirectionLock||es.hasShowCatalogCard){H.pageX/=window.devicePixelRatio;H.pageY/=window.devicePixelRatio;var E=es.card,C=H,D=C.pageX-E.pointX,B=C.pageY-E.pointY,I=E.x+D,G=E.y+B,F=H.timeStamp||Date.now();if(E.options.onBeforeScrollMove){E.options.onBeforeScrollMove.call(E,H)}E.pointX=C.pageX;E.pointY=C.pageY;if(I>0||I<E.maxScrollX){I=E.options.bounce?E.x+(D/2):I>=0||E.maxScrollX>=0?0:E.maxScrollX}if(G>E.minScrollY||G<E.maxScrollY){G=E.options.bounce?E.y+(B/2):G>=E.minScrollY||E.maxScrollY>=0?E.minScrollY:E.maxScrollY}E.distX+=D;E.distY+=B;E.absDistX=Math.abs(E.distX);E.absDistY=Math.abs(E.distY);if(E.absDistX<6&&E.absDistY<6){return}if(E.options.lockDirection){if(E.absDistX>E.absDistY+5){G=E.y;B=0}else{if(E.absDistY>E.absDistX+5){I=E.x;D=0}}}E.moved=true;E._pos(I,G);E.dirX=D>0?-1:D<0?1:0;E.dirY=B>0?-1:B<0?1:0;if(F-E.startTime>300){E.startTime=F;E.startX=E.x;E.startY=E.y}if(E.options.onScrollMove){E.options.onScrollMove.call(E,H)}}}function u(I){var G=es.card,M=I,J,L,D={dist:0,time:0},B={dist:0,time:0},F=(I.timeStamp||Date.now())-G.startTime,K=G.x,H=G.y,C;var E=es.touchEvtDiv;clearTimeout(es.timeF1);es.startCardFlag=false;E.removeEventListener(es.END_EV,u);E.removeEventListener(es.CANCEL_EV,u);if(G.options.onBeforeScrollEnd){G.options.onBeforeScrollEnd.call(G,I)}if(!G.moved){if(es.hasTouch){if(G.doubleTapTimer&&G.options.zoom){clearTimeout(G.doubleTapTimer);G.doubleTapTimer=null;if(G.options.onZoomStart){G.options.onZoomStart.call(G,I)}G.zoom(G.pointX,G.pointY,G.scale==1?G.options.doubleTapZoom:1);if(G.options.onZoomEnd){setTimeout(function(){G.options.onZoomEnd.call(G,I)},200)}}else{G.doubleTapTimer=setTimeout(function(){G.doubleTapTimer=null;J=M.target;while(J.nodeType!=1){J=J.parentNode}if(J.tagName!="SELECT"&&J.tagName!="INPUT"&&J.tagName!="TEXTAREA"){L=document.createEvent("MouseEvents");L.initMouseEvent("click",true,true,I.view,1,M.screenX,M.screenY,M.clientX,M.clientY,I.ctrlKey,I.altKey,I.shiftKey,I.metaKey,0,null);L._fake=true;J.dispatchEvent(L)}},G.options.zoom?250:0)}}G._resetPos(200);if(G.options.onTouchEnd){G.options.onTouchEnd.call(G,I)}return}if(F<300&&G.options.momentum){D=K?G._momentum(K-G.startX,F,-G.x,G.scrollerW-G.wrapperW+G.x,G.options.bounce?G.wrapperW:0):D;B=H?G._momentum(H-G.startY,F,-G.y,(G.maxScrollY<0?G.scrollerH-G.wrapperH+G.y-G.minScrollY:0),G.options.bounce?G.wrapperH:0):B;K=G.x+D.dist;H=G.y+B.dist;if((G.x>0&&K>0)||(G.x<G.maxScrollX&&K<G.maxScrollX)){D={dist:0,time:0}}if((G.y>G.minScrollY&&H>G.minScrollY)||(G.y<G.maxScrollY&&H<G.maxScrollY)){B={dist:0,time:0}}}if(D.dist||B.dist){C=Math.max(Math.max(D.time,B.time),10);G.scrollTo(Math.floor(K),Math.floor(H),C);if(G.options.onTouchEnd){G.options.onTouchEnd.call(G,I)}return}G._resetPos(200);if(G.options.onTouchEnd){G.options.onTouchEnd.call(G,I)}}x.iCard=c,x.start=j,x.move=v,x.end=h,x.startOne=s,x.endOne=b,x.nativeStart=k,x.nativeMove=a,x.nativeEnd=u,x.swipScrollHandler=o})(es);function Hammer(p,w,l){var h=this;var C={prevent_default:false,css_hacks:true,swipe:true,swipe_delay:true,swipe_double:true,swipe_time:300,swipe_max_interval:200,swipe_min_distance:20,drag:true,drag_vertical:true,drag_horizontal:true,drag_min_distance:3,transform:true,scale_treshold:0.1,rotation_treshold:15,tap:true,tap_double:true,tap_max_interval:200,tap_max_distance:3,tap_double_distance:20,hold:true,hold_timeout:500};w=F(C,w);(function(){if(!w.css_hacks){return false}var V=["webkit","moz","ms","o",""];var S={userSelect:"none",touchCallout:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"};var U="";for(var R=0;R<V.length;R++){for(var T in S){U=T;if(V[R]){U=V[R]+U.substring(0,1).toUpperCase()+U.substring(1)}p.style[U]=S[T]}}})();var L=0;var v=0;var M=0;var A={};var N=0;var k=false;var f=null;var e=null;var u=null;var E={x:0,y:0};var b=null;var O=null;var n=null;var D=null;var P={};var a=false;var j;var c;var B;var J=("ontouchstart" in window);this.option=function(R,S){if(S!=l){w[R]=S}return w[R]};this.getDirectionFromAngle=function(T){var U={down:T>=45&&T<135,left:T>=135||T<=-135,up:T<-45&&T>-135,right:T>=-45&&T<=45};var S,R;for(R in U){if(U[R]){S=R;break}}return S};function x(R){return R.touches?R.touches.length:1}function Q(U){U=U||window.event;if(!J){var W=document,S=W.body;return[{time:new Date().getTime(),x:U.pageX||U.clientX+(W&&W.scrollLeft||S&&S.scrollLeft||0)-(W&&W.clientLeft||S&&W.clientLeft||0),y:U.pageY||U.clientY+(W&&W.scrollTop||S&&S.scrollTop||0)-(W&&W.clientTop||S&&W.clientTop||0)}]}else{var Y=[],X,V=U.touches.length>0?U.touches:U.changedTouches;for(var T=0,R=V.length;T<R;T++){X=V[T];Y.push({time:new Date().getTime(),x:X.pageX,y:X.pageY})}return Y}}function q(S,R){return Math.atan2(R.y-S.y,R.x-S.x)*180/Math.PI}function s(S,T){if(S.length==2&&T.length==2){var R,W;R=S[0].x-S[1].x;W=S[0].y-S[1].y;var U=Math.sqrt((R*R)+(W*W));R=T[0].x-T[1].x;W=T[0].y-T[1].y;var V=Math.sqrt((R*R)+(W*W));return V/U}return 0}function o(T,U){if(T.length==2&&U.length==2){var S,W;S=T[0].x-T[1].x;W=T[0].y-T[1].y;var V=Math.atan2(W,S)*180/Math.PI;S=U[0].x-U[1].x;W=U[0].y-U[1].y;var R=Math.atan2(W,S)*180/Math.PI;return R-V}return 0}function K(S,T){T.touches=Q(T.originalEvent);T.type=S;var R={left:1001,right:1002,up:1003,down:1004};if(T.touches){T.x=T.touches[0].x;T.y=T.touches[0].y}if(T.direction){T.direct=R[T.direction]}if(t(h["on"+S])){h["on"+S].call(h,T)}}function G(R){R=R||window.event;if(R.preventDefault){R.preventDefault();R.stopPropagation()}else{R.returnValue=false;R.cancelBubble=true}}function H(){A={};k=false;N=0;L=0;v=0;f=null}var z={hold:function(R){if(w.hold){f="hold";clearTimeout(D);D=setTimeout(function(){if(f=="hold"){K("hold",{originalEvent:R,position:A.start})}},w.hold_timeout)}},swipe:function(R){if(!A.move){return}var aa=A.move[0].x-A.start[0].x;var Z=A.move[0].y-A.start[0].y;L=Math.sqrt(aa*aa+Z*Z);var S=new Date().getTime();var U=S-u;if(w.swipe&&(w.swipe_time>U)&&(L>w.swipe_min_distance)){v=q(A.start[0],A.move[0]);M=h.getDirectionFromAngle(v);var W={x:A.move[0].x-P.left,y:A.move[0].y-P.top};var T={left:1001,right:1002,up:1003,down:1004};var Y={originalEvent:R,position:W,direction:M,distance:L,distanceX:aa,distanceY:Z,angle:v,speed:L/U};var V=(function(){if(w.swipe_double&&e=="swipe"&&(u-O)<w.swipe_max_interval){return n==M}return false})();if(V){f="swipe_double";O=null;K("doubleswipe",Y)}else{f="swipe";O=S;n=M;K("swipe",Y)}}else{if(A.movequeue.length>4){var X=A.movequeue.length;var aa=A.move[0].x-A.movequeue[X-4][0].x;var Z=A.move[0].y-A.movequeue[X-4][0].y;L=Math.sqrt(aa*aa+Z*Z);var S=new Date().getTime();var U=S-A.movequeue[X-4][0].time;if(w.swipe_delay&&(w.swipe_time>U)&&(L>w.swipe_min_distance)){v=q(A.movequeue[X-4][0],A.move[0]);M=h.getDirectionFromAngle(v);f="swipe_delay";var W={x:A.move[0].x-P.left,y:A.move[0].y-P.top};var Y={originalEvent:R,position:W,direction:M,distance:L,distanceX:aa,distanceY:Z,angle:v,speed:L/U};K("delayswipe",Y)}}}},drag:function(W){var U=A.move[0].x-A.start[0].x;var T=A.move[0].y-A.start[0].y;L=Math.sqrt(U*U+T*T);if(w.drag&&(L>w.drag_min_distance)||f=="drag"){v=q(A.start[0],A.move[0]);M=h.getDirectionFromAngle(v);var V=(M=="up"||M=="down");if(((V&&!w.drag_vertical)||(!V&&!w.drag_horizontal))&&(L>w.drag_min_distance)){return}f="drag";var S={x:A.move[0].x-P.left,y:A.move[0].y-P.top};var R={originalEvent:W,position:S,direction:M,distance:L,distanceX:U,distanceY:T,angle:v};if(k){K("dragstart",R);k=false}K("drag",R);G(W)}},transform:function(T){if(w.transform){if(x(T)!=2){return false}var S=o(A.start,A.move);var U=s(A.start,A.move);if(f!="drag"&&(f=="transform"||Math.abs(1-U)>w.scale_treshold||Math.abs(S)>w.rotation_treshold)){f="transform";A.center={x:((A.move[0].x+A.move[1].x)/2)-P.left,y:((A.move[0].y+A.move[1].y)/2)-P.top};var R={originalEvent:T,position:A.center,scale:U,rotation:S};if(k){K("transformstart",R);k=false}K("transform",R);G(T);return true}}return false},tap:function(V){var S=new Date().getTime();var U=S-u;if(w.hold&&!(w.hold&&w.hold_timeout>U)){return}var T=(function(){if(E&&w.tap_double&&e=="tap"&&(u-b)<w.tap_max_interval){var Y=Math.abs(E[0].x-A.start[0].x);var X=Math.abs(E[0].y-A.start[0].y);return(E&&A.start&&Math.max(Y,X)<w.tap_double_distance)}return false})();if(T){f="double_tap";b=null;K("doubletap",{originalEvent:V,position:A.start});G(V)}else{var W=(A.move)?Math.abs(A.move[0].x-A.start[0].x):0;var R=(A.move)?Math.abs(A.move[0].y-A.start[0].y):0;L=Math.max(W,R);if(L<w.tap_max_distance){f="tap";b=S;E=A.start;if(w.tap){K("tap",{originalEvent:V,position:A.start});G(V)}}}}};function y(R){switch(R.type){case"mousedown":case"touchstart":A.start=Q(R);u=new Date().getTime();N=x(R);k=true;j=R;var X=p.getBoundingClientRect();var W=p.clientTop||document.body.clientTop||0;var Y=p.clientLeft||document.body.clientLeft||0;var T=window.pageYOffset||p.scrollTop||document.body.scrollTop;var U=window.pageXOffset||p.scrollLeft||document.body.scrollLeft;P={top:X.top+T-W,left:X.left+U-Y};a=true;K("press",{originalEvent:R});z.hold(R);if(w.prevent_default){G(R)}break;case"mousemove":case"touchmove":if(!a){return false}c=R;A.move=Q(R);A.movequeue?A.movequeue.push(A.move):A.movequeue=[A.move];if(!z.transform(R)){z.drag(R)}break;case"mouseup":case"mouseout":case"touchcancel":case"touchend":if(!a||(f!="transform"&&R.touches&&R.touches.length>0)){return false}a=false;B=R;var Z=f=="drag";z.swipe(R);if(Z){K("dragend",{originalEvent:R,direction:M,distance:L,angle:v})}else{if(f=="transform"){K("transformend",{originalEvent:R,position:A.center,scale:s(A.start,A.move),rotation:o(A.start,A.move)})}else{z.tap(j)}}e=f;var S=new Date().getTime();var V=S-u;K("release",{originalEvent:R,gesture:f,touch_time:V});H();break}}if(J){g(p,"touchstart touchmove touchend touchcancel",y)}else{g(p,"mouseup mousedown mousemove",y);g(p,"mouseout",function(R){if(!I(p,R.relatedTarget)){y(R)}})}function I(R,T){if(!T&&window.event&&window.event.toElement){T=window.event.toElement}if(R===T){return true}if(T){var S=T.parentNode;while(S!==null){if(S===R){return true}S=S.parentNode}}return false}function F(T,S){var R={};if(!S){return T}for(var U in T){if(U in S){R[U]=S[U]}else{R[U]=T[U]}}return R}function t(R){return Object.prototype.toString.call(R)=="[object Function]"}function g(U,T,V){T=T.split(" ");for(var S=0,R=T.length;S<R;S++){if(U.addEventListener){U.addEventListener(T[S],V,false)}else{if(document.attachEvent){U.attachEvent("on"+T[S],V)}}}}}(function(e){e.cards=[],e.bEnableTouch=false,e.tplHash={},e.cardRelation=e.cardRelation?e.cardRelation:{},e.catalogRelation=e.catalogRelation?e.catalogRelation:{};e.addSwipe2Card=function(el,swipeWay){e.swipeWay=swipeWay|0;switch(e.swipeWay){case 0:e.vDirectionLock=true;e.ce.addEvent(el,"swipe",function(evt){if(e.bEnableTouch){if(evt.direct==1001){cardSwipeLeft()}else{if(evt.direct==1002){cardSwipeRight()}}}});break;case 1:e.ce.addEvent(el,"swipe",function(evt){if(e.bEnableTouch&&e.hasShowCatalogCard&&evt.direct==1002){switchCatalogCard(e.catalogIndex)}});if(e.useNativeEventLyr){addNativeTouchSwitchCardHandler(el)}else{addWebTouchSwitchCardHandler(el)}break;default:break}};e.addTap2Card=function(el){e.ce.addEvent(el,"release",function(evt){if(e.bEnableTouch&&(evt.gesture=="tap"||evt.gesture=="hold")){var x=evt.x,y=evt.y;if(e.useNativeEventLyr){x/=window.devicePixelRatio;y/=window.devicePixelRatio}x-=e.phoneview.offsetLeft;if(e.hasShowCatalogCard&&(x<50||y<50)){switchCatalogCard(e.catalogIndex)}else{setTimeout(function(){if(e.isAndroid&&evt.gesture=="tap"&&evt.touch_time<40){if(e.tapEle){e.card.frame.contentWindow.tpl.removeHighlight(e.tapEle)}return}if(e.tapEle&&e.catalogPEl&&e.tapEle!=e.catalogPEl){e.catalogCard.frame.contentWindow.tpl.removeHighlight(e.catalogPEl)}setTimeout(function(){fireEleFunction(x,y)},100)},200)}}});e.ce.addEvent(el,"dragstart",function(){if(e.bEnableTouch){e.delayDrag=false;setTimeout(function(){if(!e.delayDrag&&e.isAndroid&&(e.card.bEnableVDrag||e.card.pullUpEl||e.card.hasShowCatalogCard)){el.addEventListener(es.MOVE_EV,e.move);el.addEventListener(es.END_EV,e.endOne);el.addEventListener(es.CANCEL_EV,e.endOne)}},100);if(e.tapEle&&e.card.frame.contentWindow.tpl&&e.card.frame.contentWindow.tpl.removeHighlight){e.card.frame.contentWindow.tpl.removeHighlight(e.tapEle);e.tapEle=null}}});e.ce.addEvent(el,"press",function(evt){if(e.bEnableTouch){if(e.useNativeEventLyr){evt.x/=window.devicePixelRatio;evt.y/=window.devicePixelRatio}evt.x-=e.phoneview.offsetLeft;var doc=e.card.frame.contentDocument;if(!doc){return}var y=evt.y;var el1=doc.elementFromPoint(evt.x,y);if(!el1){return}var id=getPIdEl(el1);if(id){if((el1.getAttribute("data-role")=="image"&&el1.getAttribute("status")==-1)||(el1.parentElement&&el1.parentElement.getAttribute("data-role")=="image"&&el1.parentElement.getAttribute("status")==-1)){}else{e.tapEle=doc.getElementById(id);if(e.card.frame.contentWindow.tpl&&e.card.frame.contentWindow.tpl.addHighlight){e.card.frame.contentWindow.tpl.addHighlight(e.tapEle)}}}}});e.touchLB.addEventListener(e.END_EV,function(){if(e.ctrlDrag){e.ctrlDrag=false;return}else{if(e.bEnableTouch){var cd=e.hasShowCatalogCard?e.backCard:e.card;goBack2ParentCard(cd)}}});e.touchRB.addEventListener(e.END_EV,function(){if(e.ctrlDrag){e.ctrlDrag=false;return}else{if(e.bEnableTouch){switchCatalogCard(e.catalogIndex)}}});e.touchLB.addEventListener(e.MOVE_EV,function(){e.ctrlDrag=true});e.touchRB.addEventListener(e.MOVE_EV,function(){e.ctrlDrag=true});e.touchLB.addEventListener(e.START_EV,function(evt){evt.stopPropagation()});e.touchRB.addEventListener(e.START_EV,function(evt){evt.stopPropagation()})};function getPIdEl(el){if(el.id){id=el.id.replace(/^\s*/,"");var pI=id.indexOf("p");if(pI==0&&(!isNaN(id.substr(1))||id.indexOf("_")>-1)){return el.id}}el=el.parentElement;if(!el||el.tagName=="BODY"||el.tagName=="HTML"){return false}else{return arguments.callee(el)}}e.fireEleTapByPos=function(tx,ty,doc){if(!doc){return}var el=doc.elementFromPoint(tx,ty);if(el.id=="rp_retry"){if(e.card.connecting){}else{retryCurCard(e.card)}return}else{if(el.id=="rp_back"){var cd=e.hasShowCatalogCard?e.backCard:e.card;goBack2ParentCard(cd);return}else{if(el.getAttribute("data-role")=="image"&&el.getAttribute("status")==-1){el.reload();return}else{if(el.parentElement&&el.parentElement.getAttribute("data-role")=="image"&&el.parentElement.getAttribute("status")==-1){el.parentElement.reload();return}}var evt=doc.createEvent("Events");evt.initEvent(e.END_EV);el.dispatchEvent(evt);if(!el){return}var id=getPIdEl(el);enterNextCard(id,tx,ty)}}};function pullUpAddData(cd,pullUpEl,ifr){if(!cd.path.dataList){return}cd.path.bottomPage=cd.path.bottomPage|0;var dt=e.card.path.dataList[cd.path.bottomPage];if(!dt){return}var nextpageUrl=dt.nextpage;if(!nextpageUrl){cd.bPullToEnd=true;pullUpEl.className="pullend";pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 0";pullUpEl.querySelector(".pullUpLabel").innerHTML="页面到底部了";return}cd.connecting=true;var npData=e.card.path.dataList[++cd.path.bottomPage];if(!npData||(npData&&npData.nextpage)){pullUpEl.className="loading";pullUpEl.querySelector(".pullUpLabel").innerHTML="加载中...";pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 100%"}if(npData){if(npData.nextpage){e.putDataIntoTpl(ifr,cd,cd.path,npData,cd.path.bottomPage)}else{cd.bPullToEnd=true;pullUpEl.className="pullend";pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 0";pullUpEl.querySelector(".pullUpLabel").innerHTML="页面到底部了"}}else{if(nextpageUrl){downloadAndPutData(ifr,cd,cd.path,false,es.proxyUrl,nextpageUrl,cd.path.bottomPage)}}}e.createCard=function(content,frameSrc,i,width,height,isStartCard,path){var cardEleObj=createCardElement(i,width,height,path.level,e.bPageNoFrame);var cd=new e.iCard(cardEleObj.iCardDiv,{bounce:true,momentum:true,isInit:false,onScrollStart:function(){if(this.lazyShowPic){clearTimeout(this.lazyShowPic)}},onScrollEnd:function(){if(e.bHighlightCtrl&&e.card.vScrollbarWrapper){recoverCtrlBar("rb");recoverCtrlBar("lb")}if(cd.connecting){return}if(this.vScrollbar&&this.options.hideScrollbar){if(e.vendor=="webkit"){this.vScrollbarWrapper.style[e.vendor+"TransitionDelay"]="200ms"}this.vScrollbarWrapper.style.opacity=0}var ifr=this.frame;if(this.frame.contentWindow&&this.frame.contentWindow.tpl){var tpl=ifr.contentWindow.tpl;var pullUpEl=this.pullUpEl;if(pullUpEl){if(pullUpEl.className.match("flip")){pullUpAddData(cd,pullUpEl,ifr)}else{if(e.bDefaultShowPic){this.lazyShowPic=setTimeout(function(){tpl.trigger("scroll")},300)}this.bFirstToEnd=this.y-20<this.maxScrollY;if(this.bFirstToEnd&&!this.bPullToEnd&&this.options.bFirstPullUp){pullUpAddData(cd,pullUpEl,ifr)}}}else{if(e.bDefaultShowPic){this.lazyShowPic=setTimeout(function(){tpl.trigger("scroll")},300)}}}else{if(e.bPageTpl&&this.pg+1==this.pgLen){if(!cd.path.dataList){return}cd.path.bottomPage=cd.path.bottomPage|0;var dt=e.card.path.dataList[cd.path.bottomPage];if(!dt){return}var nextpageUrl=dt.nextpage;if(!nextpageUrl){return}var npData=e.card.path.dataList[++cd.path.bottomPage];if(npData&&npData.nextpage){e.putDataIntoTpl(ifr,cd,cd.path,npData,cd.path.bottomPage)}else{if(nextpageUrl){downloadAndPutData(ifr,cd,cd.path,false,this.proxyUrl,nextpageUrl,cd.path.bottomPage)}}}}},onRefresh:function(){if(this.frame.contentDocument){var pullUpEl=this.pullUpEl;if(pullUpEl){if(!this.bPullToEnd&&pullUpEl.className.match("loading")){pullUpEl.className="";pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 0";pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉可加载更多"}}}},onScrollMove:function(){if(this.frame.contentDocument){var pullUpEl=this.pullUpEl;if(pullUpEl){if(!this.bPullToEnd){if(this.y<(this.maxScrollY-5)&&!pullUpEl.className.match("flip")&&(this.options.bFirstPullUp||this.bFirstToEnd)){pullUpEl.className="flip";pullUpEl.querySelector(".pullUpLabel").innerHTML="松开可加载更多";this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&pullUpEl.className.match("flip")){pullUpEl.className="";pullUpEl.querySelector(".pullUpLabel").innerHTML="上拉可加载更多";this.maxScrollY=pullUpEl.offsetHeight}}}}}}});initCardOptionsAndPutIntoData(cd,i,cardEleObj.frame,frameSrc,cardEleObj.topCardDiv,path,isStartCard,true);content.appendChild(cd.topCardDiv);es.cards.push(cd)};e.createSplit=function(content,width,height,i){var split=document.createElement("div");split.className="split";var n=e.cardWidth+e.moveWidth*i;split.style.cssText="width:"+width+"px;height:"+height+"px;margin-left:"+n+"px";content.appendChild(split)};e.createCatalogCard=function(phoneview,src,width,height,catalogData){var catalog=document.createElement("div");catalog.id="catalogIndex";es.catalogIndex=catalog;var card=document.createElement("div");card.className="card";var cardWidth="100%";var cardHeight="100%";card.style.width=cardWidth;card.style.height=cardHeight;var icardDiv=document.createElement("div");icardDiv.className="wrapper";var sDiv=document.createElement("div");var ifr=document.createElement("iframe");ifr.id="contentList";ifr.style.cssText="width:"+cardWidth+";height:"+cardHeight+";border:0";ifr.src=src;ifr.frameborder=0,ifr.scrolling="no",ifr.border=0,ifr.topmargin=0,ifr.rightmargin=0,ifr.bottommargin=0,ifr.marginwidth=0,ifr.marginheight=0;sDiv.appendChild(ifr);icardDiv.appendChild(sDiv);card.appendChild(icardDiv);catalog.appendChild(card);phoneview.appendChild(catalog);ifr.onload=function(){if(ifr.contentWindow.tpl){var wp=ifr.contentDocument.querySelector("#wrapper");wp.style.height=e.cardInnerHeight-wp.getBoundingClientRect().top+"px";ifr.contentWindow.tpl.init(catalogData,function(){var cd=new e.iCard(wp,{bounce:true,momentum:true,isInit:true,onScrollEnd:function(){}});cd.frame=ifr;cd.topCardDiv=card;es.catalogCard=cd})}}};e.createCurrentCards=function(container,width,height,index){for(var i=0;i<e.cards.length;i++){e.cards[i].destroy()}e.handles={},e.cardLoadOrder=e.cardDynaCount,e.parentPath=index;var initIndex=index.initIndex|0;if(!!index.length){e.cardLength=index.length;var indexLRObj=getCardsIndexObj(initIndex,e.cardLength,e.cardStep);if(indexLRObj.right==e.cardLength-1&&index.dataList){index.bottomPage=index.bottomPage|0;var dt=index.dataList[index.bottomPage];if(!dt){return}var nextpageUrl=dt.nextpage;if(nextpageUrl){var s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("defer",true);s.src=nextpageUrl+"&var=d";document.head.appendChild(s);s.onload=function(){if(d.code==-1||d.code==10001||d.code==10006){}else{var pg=d.page|0;index.dataList;index.dataList[pg]=d;e.setCardStructure(index,pg);e.cardLength=index.length;index.initIndex=initIndex;indexLRObj=getCardsIndexObj(initIndex,e.cardLength,e.cardStep);creatCardsAndSplit(indexLRObj,index,initIndex,container,height,width);document.head.removeChild(s)}}}else{creatCardsAndSplit(indexLRObj,index,initIndex,container,height,width)}}else{creatCardsAndSplit(indexLRObj,index,initIndex,container,height,width)}}};e.createInitCards=function(content,width,height,index,scrollType){window.location.hash="#"+index.level;if(window.history.pushState){window.history.pushState(null,"",location.pathname)}e.createCurrentCards(content,width,height,index);e.scrollType=scrollType|0;switch(e.scrollType){case 0:if(e.useNativeEventLyr){e.touchEvtDiv.addEventListener(e.START_EV,e.nativeStart)}else{e.touchEvtDiv.addEventListener(e.START_EV,e.start)}break;case 1:if(e.useNativeEventLyr){e.touchEvtDiv.addEventListener(e.START_EV,e.nativeStart)}else{if(e.bPageTpl){}else{e.touchEvtDiv.addEventListener(e.START_EV,e.startOne)}e.ce.addEvent(e.touchEvtDiv,"swipe",function(evt){if(!e.card.connecting){e.delayDrag=true;if(e.bEnableTouch&&e.card.bEnableVDrag){switch(evt.direct){case 1001:case 1002:break;case 1003:e.swipScrollHandler(evt,1);break;case 1004:e.swipScrollHandler(evt,2);break}}}})}break;default:break}top.addEventListener(e.RESIZE_EV,e.refresh);e.pullUpBgImg="background-image:url("+location.href.substring(0,location.href.lastIndexOf("/")+1)+"source/assets/images/pull-icon@2x.png);background-position:0 0;";if(e.bPageTpl){var rd=MAG.getPtPxRatio();e.pgStyle='<div style="margin-bottom: 12px;overflow:hidden;background-color: white;padding: 0;width:'+e.cardInnerWidth+"px; height:"+e.cardInnerHeight+'px">';var opr={pageWidth:e.cardInnerWidth*rd.x,pageHeight:e.cardInnerHeight*rd.y,minItmNum:3,maxItmNum:6};MAG.init(opr);MAG.hooks.constructBlockDIV=function(ts,oitm){var mds="this.style.backgroundColor = '#f0f0f0'";var mus="this.style.backgroundColor = '#ffffff'";var cks="alert('"+oitm.link+"\\nw:"+oitm.w+"\\nh:"+oitm.h+"')";ts=ts.replace(/\{\$attributes\$\}/,"id=p"+ +' onclick="'+cks+'" onmousedown="'+mds+'" onmouseup="'+mus+'" ');return ts}}};e.updateContentDiv=function(container,index,cardCount,cardStep){var indexLRObj=getCardsIndexObj(index.initIndex,cardCount,cardStep);var path=index[index.level+"_"+indexLRObj.left];for(var i=0;i<container.childNodes.length;i++){var n=container.childNodes[i];if(n.getAttribute("data-level")==path.level){break}container.removeChild(n);i--}e.rePosContent(container,index.initIndex)};e.rePosContent=function(container,initIndex,waitTime){container.style[e.vendor+"TransitionDuration"]=0;e.contentLeft=initIndex*-e.moveWidth;container.style[e.vendor+"Transform"]=e.trnOpen+e.contentLeft+"px,0"+e.trnClose;setTimeout(function(){e.waitingEl.style.visibility="hidden";e.bEnableTouch=true},waitTime|0)};e.refresh=function(){var tim=es.isAndroid?400:10;setTimeout(function(){e.mainDiv.style.height=window.innerHeight+"px";if(e.hasShowCatalogCard){switchCatalogCard(e.catalogIndex,true)}e.cardHeight=window.innerHeight;if(document.documentElement.clientWidth<640){e.cardWidth=document.documentElement.clientWidth}else{e.cardWidth=640}e.moveWidth=e.cardWidth+e.splitWidth;e.cardInnerWidth=e.cardWidth-2*e.cardBorder,e.cardInnerHeight=e.cardHeight-2*e.cardBorder;e.phoneview.style.width=e.cardWidth+"px";e.waitingEl.style.lineHeight=e.cardHeight+"px";e.waitingEl.style.visibility="visible";e.rePosContent(e.contentDiv,e.card.index,1000);var cardWidth=e.cardInnerWidth+"px";var cardHeight=e.cardInnerHeight+"px";if(e.catalogCard){var wp=es.catalogCard.frame.contentDocument.querySelector("#wrapper");wp.style.height=e.cardInnerHeight-wp.getBoundingClientRect().top+"px";e.catalogCard.refresh();var sls=e.contentDiv.querySelectorAll(".split");var lc=parseInt(es.cards[0].topCardDiv.getAttribute("data-index"));for(var i=0;i<sls.length;i++){sls[i].style.height=e.cardHeight+"px";sls[i].style.marginLeft=e.cardWidth+e.moveWidth*(lc+i)+"px"}}for(var i=0;i<e.cards.length;i++){var cd=e.cards[i];cd.topCardDiv.style.width=cardWidth;cd.topCardDiv.style.height=cardHeight;cd.frame.style.width=cardWidth;cd.frame.style.height=cardHeight;var j=cd.topCardDiv.getAttribute("data-index");cd.topCardDiv.style[e.vendor+"Transform"]=e.trnOpen+(j*e.moveWidth)+"px,0"+e.trnClose;if(cd.path.level=="p_0"){var v=cd.frame.contentDocument.body.querySelector("#view");if(v){v.style.height=e.cardInnerHeight+"px"}}cd.refresh()}},tim)};e.setLogicStructure=function(url){e$().xhr(url,{async:false,error:function(){console.log("read "+url+" error")},callback:function(){eval("es.cardRelation="+this.responseText);e.deepextend(es.catalogRelation,es.cardRelation)}})};e.initLogicStructure=function(catalogData){e.cardRelation=catalogData;e.deepextend(e.catalogRelation,e.cardRelation)};e.initPageForCard=function(ele,viewW,viewH){var phoneview=createPhoneview(ele,viewW,viewH);createTouchEvent(phoneview);return phoneview};e.setPage=function(ele,src,cd){ele.src=src;var count=2,i=0;if(cd==e.card&&e.backId){cd.topCardDiv.style.visibility="hidden"}ele.onload=function(){if(ele.contentDocument){var state=ele.contentDocument.readyState;if(state=="loaded"||state=="complete"){if(e.isAndroid){ele.contentDocument.body.style.backgroundColor="transparent"}cd.scroller=cd.frame.contentDocument.body;if(e.bLeastFrameRequest){if(!e.tplHash[src]){e.tplHash[src]=ele.contentDocument.documentElement.cloneNode(true)}}if(cd.path.dataSource){var tpl=ele.contentWindow.tpl;if(tpl&&tpl.headline){tpl.headline(cd.path.name,cd.path.author,cd.path.pubDate)}if(++cd.dataAndLoad==2){cd.path.dataList=cd.path.dataList||[];var ttype=ele.contentWindow.template_type;var d=cd.path.dataList[0];if(ttype&&d.type!=ttype){cd.dataAndLoad--;var src1="";if(d.type=="list"){src1=e.catalogRelation.template.list}else{if(d.type=="article"){src1=e.catalogRelation.template.article}}cd.frameSrc=src1;cd.path.template=src1;es.setPage(ele,src1,cd)}else{for(var j=0;j<cd.path.dataList.length;j++){e.putDataIntoTpl(ele,cd,cd.path,cd.path.dataList[j],j)}}}else{var d=document.createElement("div");d.id="es_loading";d.innerHTML='<p style="line-height:300px;top:0;position:absolute;width:'+e.cardWidth+'px;text-align: center">请求中...</p>';ele.contentDocument.body.appendChild(d)}}else{if(cd.path.level=="p_0"&&e.cover){cd.frame.contentDocument.body.querySelector("#main").appendChild(e.cover.cloneNode());cd.frame.contentDocument.body.querySelector("#at").appendChild(e.title.cloneNode())}cd.refresh()}if(e.bBack2ParentCard&&cd==e.card){e.bBack2ParentCard=false}else{cd._pos(0,0)}if(cd.vScrollbar&&cd.options.hideScrollbar){cd.vScrollbarWrapper.style.opacity=0}}else{ele.src="default.html"}}else{if(count<i++){ele.src="default.html"}else{ele.src=src}}}};e.putDataIntoTpl=function(ifr,cd,path,data,page){if(data){if(ifr.contentWindow){var tpl=ifr.contentWindow.tpl;if(tpl){if(page){tpl.append(data,function(){cd.connecting=false;cd.refresh();if(e.bDefaultShowPic){tpl.trigger("scroll")}})}else{tpl.init(data,function(){var win=ifr.contentWindow;if(win){if(win.retryPage){ifr.contentDocument.body.removeChild(win.retryPage)}if(win.es_loading){ifr.contentDocument.body.removeChild(win.es_loading)}}if(data.nextpage&&!cd.pullUpEl){var pullUp=ifr.contentDocument.createElement("div");pullUp.id="pullUp";var pullUpDiv=ifr.contentDocument.createElement("div");pullUpDiv.id="pullUpDiv";pullUpDiv.appendChild(pullUp);ifr.contentDocument.body.appendChild(pullUpDiv);cd.pullUpEl=pullUp;var bHasEnd=path.dataList[cd.path.dataList.length-1].nextpage;if(bHasEnd){pullUp.innerHTML='<span class="pullUpIcon" style="'+e.pullUpBgImg+'"></span><span class="pullUpLabel">上拉可加载更多</span>'}else{cd.bPullToEnd=true;pullUp.className="pullend";pullUp.innerHTML='<span class="pullUpIcon" style="'+e.pullUpBgImg+'"></span><span class="pullUpLabel">页面到底部了</span>'}}cd.connecting=false;if(cd==e.card){if(e.backId){setTimeout(function(){cd.posToElement(cd.scroller.querySelector(e.backId));cd.topCardDiv.style.visibility="visible";e.backId=false},0)}if(e.bDefaultShowPic){tpl.trigger("scroll")}}cd.refresh()},function(){cd.refresh()})}}}else{if(e.bPageTpl){var sUrl=cd.path.level+page;if(page){MAG.appendData(sUrl,data);cd.pgLen+=MAG.getTotalPageNumber(sUrl);var hts=MAG.getPageHTML(sUrl,{start:0,end:-1});var sOutHtml="";for(var i=0;i<hts.length;i++){sOutHtml+=e.pgStyle+hts[i].html+"</div>"}if(e.bPageNoFrame){ifr.innerHTML+=sOutHtml}else{ifr.contentDocument.body.innerHTML+=sOutHtml}}else{MAG.appendData(sUrl,data);cd.pgLen=MAG.getTotalPageNumber(sUrl);var hts=MAG.getPageHTML(sUrl,{start:0,end:-1});var sOutHtml="";for(var i=0;i<hts.length;i++){sOutHtml+=e.pgStyle+hts[i].html+"</div>"}if(e.bPageNoFrame){ifr.innerHTML=sOutHtml}else{ifr.contentDocument.body.innerHTML+=sOutHtml}var win=ifr.contentWindow;if(win){if(win.retryPage){ifr.contentDocument.body.removeChild(win.retryPage)}if(win.es_loading){ifr.contentDocument.body.removeChild(win.es_loading)}}}cd.connecting=false;cd.refresh()}}}else{cd.connecting=false;if(!ifr.contentWindow.retryPage){injectFailElement(ifr.contentDocument.body,path.level.split("_").length>2)}}};function setChildStructure(path,tempUrl,page){var list=path.dataList[page].data;path.initIndex=0;var l=path.level;var s=path.dataList[0].data.length*page;path.length=s+list.length;for(var i=0;i<list.length;i++){var d=list[i],p=l+"_"+(i+s);path[p]={name:d.title,author:d.author,pubDate:d.pubDate,dataSource:d.link,template:tempUrl,level:p}}}e.setCardStructure=function(path,page){switch(path.childType){case"list":if(path.dataList[page].type=="list"){setChildStructure(path,e.catalogRelation.template.list,page)}break;case"article":setChildStructure(path,e.catalogRelation.template.article,page);break;case undefined:if(path.dataList[page].type=="list"){setChildStructure(path,e.catalogRelation.template.article,page)}break;default:break}};e.scaleCard=function(el,x,y,isTransparent,duration,originX,originY){el.style[e.vendor+"TransitionDuration"]=duration;if(isTransparent){el.style.opacity=0}if(originX&&originY){el.style[e.vendor+"TransformOrigin"]=originX+"px "+originY+"px"}el.style[e.vendor+"Transform"]="scale("+x+","+y+")";setTimeout(function(){e.waitingEl.style.visibility="visible"},e.cardSwitchTime-300)};e.returnScaleCard=function(el){el.style[e.vendor+"TransitionDuration"]=0;el.style[e.vendor+"TransformOrigin"]="50% 50%";el.style.opacity=1;el.style[e.vendor+"Transform"]="scale(1,1)"};e.backButtonHandler=function(evt){var tims=new Date;if(!e.backButFirstTims){e.backButFirstTims=tims}else{var t=tims-e.backButFirstTims;if(t<e.backBtnDur){e.device.quit();return}e.backButFirstTims=tims}if(e.hasShowCatalogCard){switchCatalogCard(e.catalogIndex)}else{goBack2ParentCard(e.card)}};e.menuButtonHandler=function(evt){switchCatalogCard(e.catalogIndex)};function fireEleFunction(x,y){e.fireEleTapByPos(x,y,e.card.frame.contentDocument)}function createPhoneview(ele,viewW,viewH){var phoneview=document.createElement("div");phoneview.className="phoneview";phoneview.style.width=viewW+"px";phoneview.id="phoneview";var content=document.createElement("div");content.className="content";content.id="content";content.setAttribute("data-currentCard",0);phoneview.appendChild(content);ele.appendChild(phoneview);e.contentDiv=content;e.phoneview=phoneview;return phoneview}function createTouchEvent(phoneview){var ev=document.createElement("div");ev.id="touchevent";ev.className="touchevent";var lt=document.createElement("div");lt.id="toucheventLT";lt.className="toucheventLT toucheventLTNormal";ev.appendChild(lt);var lb=document.createElement("div");lb.id="toucheventLB";lb.className="toucheventLB toucheventLBNormal";ev.appendChild(lb);var rt=document.createElement("div");rt.id="toucheventRT";rt.className="toucheventRT toucheventRTNormal";ev.appendChild(rt);var rb=document.createElement("div");rb.id="toucheventRB";rb.className="toucheventRB toucheventRBNormal";ev.appendChild(rb);var waitingEl=document.createElement("div");waitingEl.className="waitingel";waitingEl.style.lineHeight=e.cardInnerHeight+"px";waitingEl.innerHTML="等待中...";ev.appendChild(waitingEl);phoneview.appendChild(ev);es.touchEvtDiv=ev,es.touchLT=lt,es.touchLB=lb,es.touchRT=rt,es.touchRB=rb,es.waitingEl=waitingEl}function creatCardsAndSplit(indexLRObj,index,initIndex,container,height,width){if(e.card){e.returnFrm=e.card.frame}var n=0,bCreateFrs=false;for(var i=indexLRObj.left;i<=indexLRObj.right;i++){var path=index[index.level+"_"+i];var src=path.template;var isAsStartIndex=initIndex==i?true:false;if(e.bLeastFrameRequest&&e.tplHash[src]){bCreateFrs=true;var cd=e.cards[n++];cd.topCardDiv.style[e.vendor+"Transform"]=e.trnOpen+i*e.moveWidth+"px,0"+e.trnClose;cd.topCardDiv.setAttribute("data-level",path.level);initCardOptionsAndPutIntoData(cd,i,cd.frame,src,cd.topCardDiv,path,isAsStartIndex)}else{if(i==indexLRObj.left){e.cards=[]}if(path.level=="p_0"){if(!src){src=e.catalogRelation.template.cover}}else{if(!src){if(index.childType=="list"){src=e.catalogRelation.template.list}else{if(index.childType=="article"){src=e.catalogRelation.template.article}else{src=undefined}}}}if(i>indexLRObj.left){e.createSplit(container,e.splitWidth,e.cardHeight,i-1)}e.createCard(container,src,i,width,height,isAsStartIndex,path)}}setTimeout(function(){if(e.bLeastFrameRequest&&bCreateFrs){e.returnScaleCard(e.returnFrm);e.rePosContent(container,initIndex)}else{e.updateContentDiv(container,index,e.cardLength,e.cardStep)}},e.cardSwitchTime)}function highlightCtrlBar(pos){switch(pos){case"lt":document.getElementById("toucheventLT").className="toucheventLT toucheventLTHighlight";break;case"lb":document.getElementById("toucheventLB").className="toucheventLB toucheventLBHighlight";break;case"rt":document.getElementById("toucheventRT").className="toucheventRT toucheventRTHighlight";break;case"rb":document.getElementById("toucheventRB").className="toucheventRB toucheventRBHighlight";break}}function recoverCtrlBar(pos){switch(pos){case"lt":document.getElementById("toucheventLT").className="toucheventLT toucheventLTNormal";break;case"lb":document.getElementById("toucheventLB").className="toucheventLB toucheventLBNormal";break;case"rt":document.getElementById("toucheventRT").className="toucheventRT toucheventRTNormal";break;case"rb":document.getElementById("toucheventRB").className="toucheventRB toucheventRBNormal";break}}function getNextRIndex(){return es.card.index+es.cardStep+1}function getNextLIndex(){return es.card.index-es.cardStep-1}function rePosLeftCard(level){e.abandonCd=e.cards.shift();var sls=e.contentDiv.querySelectorAll(".split");for(var i=0;i<sls.length;i++){sls[i].style.marginLeft=sls[i].offsetLeft+e.moveWidth+"px"}e.abandonCd.topCardDiv.setAttribute("data-level",level);e.abandonCd.topCardDiv.style[e.vendor+"Transform"]=e.trnOpen+e.moveWidth*(e.abandonCd.index+e.cardDynaCount)+"px,0"+e.trnClose;e.abandonCd.pullUpEl=null}function rePosRightCard(level){e.abandonCd=es.cards.pop();var sls=e.contentDiv.querySelectorAll(".split");for(var i=0;i<sls.length;i++){sls[i].style.marginLeft=sls[i].offsetLeft-e.moveWidth+"px"}e.abandonCd.topCardDiv.setAttribute("data-level",level);e.abandonCd.topCardDiv.style[e.vendor+"Transform"]=e.trnOpen+e.moveWidth*(e.abandonCd.index-e.cardDynaCount)+"px,0"+e.trnClose;e.abandonCd.topCardDiv.setAttribute("data-level",level);e.abandonCd.pullUpEl=null}function getCardsIndexObj(iCurr,iLen,step,isCircle){var l=r=0;var ls=iCurr;if(isCircle){}else{var tl=iCurr-step;if(tl>0){l=tl;ls=step}var tr=l+2*step;if(tr>iLen-1){r=iLen-1;ls=ls+tr-r;l=iCurr-ls;if(l<0){l=0;ls=iCurr}}else{r=tr}return{left:l,right:r,leftCardCount:ls}}}function switchCatalogCard(catalogIndex,isDirectSwitch,bHistory){catalogIndex.style[e.vendor+"TransitionDuration"]=isDirectSwitch?0:e.cardSwitchTime+"ms";if(es.hasShowCatalogCard){if(e.tapEle){e.catalogCard.frame.contentWindow.tpl.removeHighlight(e.tapEle);e.tapEle=null}if(e.catalogPEl){e.catalogCard.frame.contentWindow.tpl.removeHighlight(e.catalogPEl);e.catalogPEl=null}es.hasShowCatalogCard=false;es.card=es.backCard;catalogIndex.style[e.vendor+"Transform"]=e.trnOpen+"0,0"+e.trnClose;setTimeout(function(){catalogIndex.style.visibility="hidden"},e.cardSwitchTime);refreshControlStatus(es.card.path.level)}else{var curl=e.card.path.level;var el=e.catalogCard.scroller.querySelector("#"+curl);if(!el){m=curl.split("_");if(m.length>=2){var s="#";for(var i=0;i<m.length-2;i++){s+=m[i]+"_"}s+=m[m.length-2];el=e.catalogCard.scroller.querySelector(s)}}e.catalogCard.frame.contentWindow.tpl.addHighlight(el);e.catalogPEl=el;e.catalogCard.posToElement(el);catalogIndex.style.visibility="visible";es.hasShowCatalogCard=true;es.backCard=es.card;es.card=es.catalogCard;catalogIndex.style[e.vendor+"Transform"]=e.trnOpen+(-catalogIndex.offsetLeft)+"px,"+(-catalogIndex.offsetHeight)+"px"+e.trnClose;refreshControlStatus("p_1");if(!bHistory){e.bHisToryButton=false;if(window.location.hash=="#so"){window.location.hash="#s"}else{window.location.hash="#so"}}}}function getPathObjByStr(rootObj,levelStr){var t=[];var l=levelStr.split("_");if(l.length==1){return rootObj}else{for(var i=1;i<l.length;i++){var m=l[0];for(var j=1;j<=i;j++){m=m+"_"+l[j]}t.push(m)}return eval("rootObj."+t.join("."))}}function getParentPathObjByStr(rootObj,levelStr){var t=[];var l=levelStr.split("_");if(l.length==1){return rootObj}else{for(var i=1;i<l.length-1;i++){var m=l[0];for(var j=1;j<=i;j++){m=m+"_"+l[j]}t.push(m)}if(t.length>0){return eval("rootObj."+t.join("."))}else{return rootObj}}}function getSiblingObjByStr(rootObj,levelStr,nextNum){var t=[];var l=levelStr.split("_");if(l.length==1){return rootObj}else{for(var i=1;i<l.length-1;i++){var m=l[0];for(var j=1;j<=i;j++){m=m+"_"+l[j]}t.push(m)}if(t.length>0){var ret=levelStr.substring(0,levelStr.lastIndexOf("_")+1);return eval("rootObj."+t.join(".")+"."+ret+nextNum)}else{return rootObj["p_"+nextNum]}}}function getBackPathObjByStr(rootObj,levelStr){var t=[];var l=levelStr.split("_");if(l.length==2){return null}else{for(var i=1;i<l.length-2;i++){var m=l[0];for(var j=1;j<=i;j++){m=m+"_"+l[j]}t.push(m)}var r=rootObj;if(t.length>0){r=eval("rootObj."+t.join("."))}l.pop();r.initIndex=l.pop();return r}}function goBack2ParentCard(cd,bHistory){if(!cd){return}var parentPath=getBackPathObjByStr(e.cardRelation.index,cd.path.level);if(parentPath){e.scaleCard(cd.frame,0.6,0.6,true,e.cardSwitchTime+"ms");var level=cd.path.level;e.backId="#p"+level.substr(level.lastIndexOf("_")+1);e.bBack2ParentCard=true;setTimeout(function(){e.createCurrentCards(e.contentDiv,e.cardInnerWidth,e.cardInnerHeight,parentPath)},e.loadDelayTime);if(!bHistory){e.bHisToryButton=false;window.location.hash="#"+cd.path.level}}else{var t=e.card.path.level.split("_");if(t.length==2&&t[1]!=e.catalogRelation.index.initIndex){e.cardRelation.index.initIndex=e.catalogRelation.index.initIndex;e.contentDiv.innerHTML="";e.waitingEl.style.visibility="visible";setTimeout(function(){e.waitingEl.style.visibility="hidden"},300);e.createCurrentCards(e.contentDiv,e.cardInnerWidth,e.cardInnerHeight,e.cardRelation.index)}}}function injectFailElement(el,bHasBackBtn,reTryFailTxt){var rp=document.createElement("div");rp.style.cssText="position:absolute;top:0;width:100%;height:100%";rp.id="retryPage";rp.innerHTML='<p style="text-align:center;margin-top: 40%">页面加载出错...</p>';var rt=document.createElement("button");rt.id="rp_retry";rt.style.cssText="margin-left:15%;float:left";rt.innerText="重新加载";rp.appendChild(rt);if(bHasBackBtn){var bk=document.createElement("button");bk.id="rp_back";bk.style.cssText="margin-right:15%;float:right";bk.innerText="返回上一级";rp.appendChild(bk)}var rft=document.createElement("p");rft.id="rft_message";rft.style.marginTop="15%";rft.style.height="10px";rft.style.textAlign="center";if(reTryFailTxt){rft.innerHTML=reTryFailTxt}rp.appendChild(rft);var root=document.createElement("p");root.style.marginTop="15%";root.style.textAlign="center";root.innerHTML="左右拖动可阅读其它内容";rp.appendChild(root);el.appendChild(rp)}function retryCurCard(cd){console.log("重试一次url为:"+cd.path.dataSource);var ifr=cd.frame;if(ifr.contentWindow&&ifr.contentWindow.retryPage){ifr.contentWindow.rft_message.innerHTML="重试请求中...";ifr.contentWindow.rp_retry.style.visibility="hidden"}downloadAndPutData(cd.frame,cd,cd.path,false,es.proxyUrl,cd.path.dataSource,0)}function getRequestStyle(url){if(url.indexOf("http")==-1){return 0}else{if(e.proxyType){return 3}else{if(url.indexOf(e.fastLinkId)==-1){return 2}else{return 1}}}}e.retryDataRequest=function(cd,ifr,path){if(cd.dataRetryFlag==0&&ifr.contentWindow&&ifr.contentWindow.tpl){ifr.contentWindow.tpl.init()}if(cd.dataRetryFlag++<e.retryTimes){retryCurCard(cd)}else{cd.connecting=false;if(ifr.contentWindow){if(ifr.contentWindow.es_loading){ifr.contentDocument.body.removeChild(ifr.contentWindow.es_loading)}if(ifr.contentWindow.retryPage){ifr.contentWindow.rft_message.innerHTML="重试后仍然出错，请再重试或放弃";ifr.contentWindow.rp_retry.style.visibility="visible"}else{injectFailElement(ifr.contentDocument.body,path.level.split("_").length>2)}}}};e.reorganizeData=function(data,bFirstPage){if(!bFirstPage&&data.type=="list"){var list=data.data;if(!(list[0].image&&list[0].image.type=="image")){for(var i=1;i<list.length;i++){if(list[i].image&&list[i].image.type=="image"){Array.prototype.unshift.apply(list,list.splice(i,1));break}}}}};function downloadAndPutData(ifr,cd,path,isXHR,proxyURL,dataSource,page){cd._tm=new Date;var requestStyle=getRequestStyle(dataSource);cd.connecting=true;switch(requestStyle){case 0:case 3:if(e.proxyType==1&&requestStyle==3){var s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("defer",true);if(page==0){s.src=proxyURL+"?url="+encodeURI(dataSource)+"&var=d&t="+Date.now()}else{s.src=dataSource+"&var=d"}document.head.appendChild(s);s.onload=function(){if(d.code==-1||d.code==10001||d.code==10006){e.retryDataRequest(cd,ifr,path,dataSource)}else{var pg=d.page|0;e.reorganizeData(d,pg);path.bottomPage=pg;path.dataList=path.dataList||[];path.dataList[pg]=d;if(cd.pullUpEl&&!d.nextpage){cd.bPullToEnd=true;cd.pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 0";cd.pullUpEl.className="pullend";cd.pullUpEl.querySelector(".pullUpLabel").innerHTML="页面到底部了"}e.setCardStructure(path,pg);if(pg||++cd.dataAndLoad==2){if(ifr.contentWindow&&ifr.contentWindow.template_type&&ifr.contentWindow.template_type!=d.type){cd.dataAndLoad--;var src="";if(d.type=="list"){src=e.catalogRelation.template.list}else{if(d.type=="article"){src=e.catalogRelation.template.article}}cd.frameSrc=src;cd.path.template=src;es.setPage(ifr,src,cd)}else{e.putDataIntoTpl(ifr,cd,path,d,pg)}}}document.head.removeChild(s)}}else{e$().xhr(dataSource,{async:true,error:function(){console.log("read local json error")},callback:function(){try{var d=JSON.parse(this.responseText)}catch(e){console.log("JSON.parse error in downloadAndPutData");return}if(d.code==-1||d.code==10001||d.code==10006){e.retryDataRequest(cd,ifr,path);return}else{var pg=d.page|0;e.reorganizeData(d,pg);path.bottomPage=pg;path.dataList=path.dataList||[];path.dataList[pg]=d;if(cd.pullUpEl&&!d.nextpage){cd.bPullToEnd=true;cd.pullUpEl.querySelector(".pullUpIcon").style.backgroundPosition="0 0";cd.pullUpEl.className="pullend";cd.pullUpEl.querySelector(".pullUpLabel").innerHTML="页面到底部了"}e.setCardStructure(path,pg);if(ifr.src){if(pg||++cd.dataAndLoad==2){e.putDataIntoTpl(ifr,cd,path,d,pg)}}else{++cd.dataAndLoad;if(d.type=="list"){es.setPage(ifr,e.catalogRelation.template.list,cd)}else{if(d.type=="article"){es.setPage(ifr,e.catalogRelation.template.article,cd)}}}}}})}break;case 1:e.handles[dataSource]=cd;if(cd==es.card){e.proxy.requestWithProxy(_successProxyFunc,_errorProxyFunc,dataSource,{bDirectVisit:true,proxyUrl:proxyURL,method:"get",priorFactor:9})}else{e.proxy.requestWithProxy(_successProxyFunc,_errorProxyFunc,dataSource,{bDirectVisit:true,proxyUrl:proxyURL,method:"get"})}break;case 2:e.handles[dataSource]=cd;if(cd==es.card){e.proxy.requestWithProxy(_successProxyFunc,_errorProxyFunc,dataSource,{proxyUrl:proxyURL,method:"get",priorFactor:9})}else{e.proxy.requestWithProxy(_successProxyFunc,_errorProxyFunc,dataSource,{proxyUrl:proxyURL,method:"get"})}break}}e.cardControlStatus={LT:false,RT:false,LB:true,RB:true};function refreshControlStatus(level){if(typeof es.cardRelation.index.p_0.isDynamic!="undefined"&&level=="p_0"){e.cardControlStatus.RB=false;e.touchRB.style.visibility="hidden"}else{e.cardControlStatus.RB=true;e.touchRB.style.visibility="visible"}if(level.split("_").length<=2){e.cardControlStatus.LB=false;e.touchLB.style.visibility="hidden"}else{e.cardControlStatus.LB=true;e.touchLB.style.visibility="visible"}e.cardControlStatus.LT=false;e.touchLT.style.visibility="hidden";e.cardControlStatus.RT=false;e.touchRT.style.visibility="hidden"}function swipeLeftPutData(nextNum){var siblingPath=getSiblingObjByStr(e.cardRelation.index,e.card.path.level,nextNum);rePosLeftCard(siblingPath.level);var cd=e.abandonCd;cd.isloadframe=cd.frameSrc==siblingPath.template;initCardOptionsAndPutIntoData(cd,nextNum,cd.frame,siblingPath.template,cd.topCardDiv,siblingPath,false,false,cd.isloadframe);e.cards.push(cd)}function putNextPageData(nextNum){var parentPath=getParentPathObjByStr(e.cardRelation.index,e.card.path.level);if(!parentPath.dataList){return}parentPath.bottomPage=parentPath.bottomPage|0;var dt=parentPath.dataList[parentPath.bottomPage];if(!dt){return}var nextpageUrl=dt.nextpage;if(nextpageUrl){var s=document.createElement("script");s.setAttribute("type","text/javascript");s.setAttribute("defer",true);s.src=nextpageUrl+"&var=d";document.head.appendChild(s);s.onload=function(){if(d.code==-1||d.code==10001||d.code==10006){}else{var pg=d.page|0;parentPath.bottomPage=pg;parentPath.dataList=parentPath.dataList||[];parentPath.dataList[pg]=d;e.setCardStructure(parentPath,pg);e.cardLength=parentPath.length;swipeLeftPutData(nextNum)}document.head.removeChild(s)}}}function swipeLeftEndHandler(){var indexLRObj=getCardsIndexObj(e.card.index+1,e.cardLength,e.cardStep);e.contentDiv.style[e.vendor+"TransitionDuration"]=0;var nextNum=getNextRIndex();if(nextNum<e.cardLength&&indexLRObj.left>0){swipeLeftPutData(nextNum)}else{if(nextNum>=e.cardLength&&indexLRObj.left>0){putNextPageData(nextNum)}}if(e.card.vScrollbar&&e.card.options.hideScrollbar){e.card.vScrollbarWrapper.style.opacity=0}e.card=e.cards[indexLRObj.leftCardCount];updateReaded(e.parentPath,e.card.index);if(e.card.frame.contentWindow&&e.card.frame.contentWindow.tpl){var tpl=e.card.frame.contentWindow.tpl;if(tpl.run){tpl.run()}else{if(e.bDefaultShowPic&&tpl.trigger){e.card.frame.contentWindow.tpl.trigger("scroll")}}}refreshControlStatus(e.card.path.level);e.bEnableTouch=true}function cardSwipeLeft(){if(!e.hasShowCatalogCard){if(e.card.index<e.cardLength-1){e.contentLeft=(-1-e.card.index)*e.moveWidth;e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+e.contentLeft+"px,0"+e.trnClose;e.contentDiv.style[e.vendor+"TransitionDuration"]=e.transTime+"ms";e.bEnableTouch=false;e.evt.one(e.contentDiv,"webkitTransitionEnd",swipeLeftEndHandler)}else{reBackCardPosition(e.contentDiv,e.transTime,e.contentLeft,0)}}}function swipeRightendHandler(){var indexLRObj=getCardsIndexObj(e.card.index-1,e.cardLength,e.cardStep);e.contentDiv.style[e.vendor+"TransitionDuration"]=0;var nextNum=getNextLIndex();if(nextNum>=0&&indexLRObj.right<e.cardLength-1){var siblingPath=getSiblingObjByStr(e.cardRelation.index,e.card.path.level,nextNum);rePosRightCard(siblingPath.level);var cd=e.abandonCd;cd.isloadframe=cd.frameSrc==siblingPath.template;initCardOptionsAndPutIntoData(cd,nextNum,cd.frame,siblingPath.template,cd.topCardDiv,siblingPath,false,false,cd.isloadframe);e.cards.unshift(cd)}if(e.card.vScrollbar&&e.card.options.hideScrollbar){e.card.vScrollbarWrapper.style.opacity=0}e.card=e.cards[indexLRObj.leftCardCount];updateReaded(e.parentPath,e.card.index);if(e.card.frame.contentWindow&&e.card.frame.contentWindow.tpl){var tpl=e.card.frame.contentWindow.tpl;if(tpl.run){tpl.run()}else{if(e.bDefaultShowPic&&tpl.trigger){tpl.trigger("scroll")}}}refreshControlStatus(e.card.path.level);e.bEnableTouch=true}function cardSwipeRight(){if(e.hasShowCatalogCard){switchCatalogCard(e.catalogIndex)}else{if(e.card.index>0){e.contentLeft=(1-e.card.index)*e.moveWidth;e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+e.contentLeft+"px,0"+e.trnClose;e.contentDiv.style[e.vendor+"TransitionDuration"]=e.transTime+"ms";e.bEnableTouch=false;e.evt.one(e.contentDiv,"webkitTransitionEnd",swipeRightendHandler)}else{reBackCardPosition(e.contentDiv,e.transTime,e.contentLeft,1)}}}function enterNextCard(id,tx,ty){if(id){e.bBack2ParentCard=false;if(e.hasShowCatalogCard){if(id==e.backCard.path.level){switchCatalogCard(e.catalogIndex,true);return}var path=getParentPathObjByStr(e.cardRelation.index,id);var parentIndex=id.substr(id.lastIndexOf("_")+1);path.initIndex=parseInt(parentIndex);e.contentDiv.innerHTML="";e.createCurrentCards(e.contentDiv,e.cardInnerWidth,e.cardInnerHeight,path);es.card=es.backCard;setTimeout(function(){switchCatalogCard(e.catalogIndex,true)},e.cardSwitchTime)}else{var path=getPathObjByStr(e.cardRelation.index,e.card.path.level);path.initIndex=parseInt(id.substr(1));e.scaleCard(e.card.frame,1.5,1.5,true,e.cardSwitchTime+"ms",tx,ty);setTimeout(function(){e.createCurrentCards(es.contentDiv,es.cardInnerWidth,es.cardInnerHeight,path)},e.loadDelayTime);e.bHisToryButton=false;window.location.hash="#"+path.level}}}function createCardElement(i,width,height,level,bPageNoFrame){var card=document.createElement("div");card.setAttribute("data-index",i);card.setAttribute("data-level",level);card.className="card";var cardWidth=width+"px";var cardHeight=height+"px";card.style.width=cardWidth;card.style.height=cardHeight;card.style[e.vendor+"Transform"]=e.trnOpen+i*e.moveWidth+"px,0"+e.trnClose;var icardDiv=document.createElement("div");icardDiv.className="wrapper";var sDiv=document.createElement("div");if(bPageNoFrame){var ifr=document.createElement("div");ifr.style.cssText="border:0"}else{var ifr=document.createElement("iframe");ifr.style.cssText="width:"+cardWidth+";height:"+cardHeight+";border:0";ifr.scrolling="no"}sDiv.appendChild(ifr);icardDiv.appendChild(sDiv);card.appendChild(icardDiv);return{iCardDiv:icardDiv,frame:ifr,topCardDiv:card}}function putDataOrRequestData(cd,path,frameSrc,bReUse){if(bReUse){if(cd.frame.contentWindow){var win=cd.frame.contentWindow;if(win.pullUpDiv){win.document.body.removeChild(win.pullUpDiv)}var tpl=win.tpl;if(tpl){tpl.init();cd._pos(0,0);if(tpl.headline){tpl.headline(cd.path.name,cd.path.author,cd.path.pubDate)}}}if(e.bPageNoFrame){cd._pos(0,0)}if(path.dataList&&path.dataList[0]){for(var j=0;j<cd.path.dataList.length;j++){e.putDataIntoTpl(cd.frame,cd,cd.path,cd.path.dataList[j],j)}}else{if(path.dataSource){cd.dataAndLoad++;downloadAndPutData(cd.frame,cd,path,false,e.proxyUrl,path.dataSource,0)}}}else{if(path.dataList&&path.dataList[0]){cd.dataAndLoad++}else{if(path.dataSource){downloadAndPutData(cd.frame,cd,path,false,e.proxyUrl,path.dataSource,0)}}if(e.bPageNoFrame){++cd.dataAndLoad;if(path.dataSource){downloadAndPutData(cd.frame,cd,path,false,e.proxyUrl,path.dataSource,0)}else{}}else{if(e.bLeastFrameRequest){if(e.tplHash[frameSrc]){cd.frame.contentDocument.clear();var tEl=cd.frame.contentDocument.documentElement;tEl.removeChild(cd.frame.contentDocument.body);tEl.removeChild(cd.frame.contentDocument.head);for(var i=0;i<e.tplHash[frameSrc].childNodes.length;i++){tEl.appendChild(e.tplHash[frameSrc].childNodes[i].cloneNode(true))}if(e.isAndroid){cd.frame.contentDocument.body.style.backgroundColor="transparent"}if(frameSrc=="template/wp7/cover.html"&&e.cover){cd.frame.contentDocument.body.querySelector("#main").appendChild(e.cover.cloneNode());cd.frame.contentDocument.body.querySelector("#at").appendChild(e.title.cloneNode());cd.refresh()}else{cd.frame.contentDocument.body.style.cssText="-webkit-transform: translate3d(0px, 0px, 0); -webkit-transition: 0ms;";cd.scroller=cd.frame.contentDocument.body;cd.frame.contentWindow.eval(cd.frame.contentDocument.getElementById("es_list").innerText);if(cd.path.dataSource){var tpl=cd.frame.contentWindow.tpl;if(tpl&&tpl.headline){tpl.headline(cd.path.name,cd.path.author,cd.path.pubDate)}downloadAndPutData(cd.frame,cd,path,false,e.proxyUrl,path.dataSource,0)}}}else{e.setPage(cd.frame,frameSrc,cd)}}else{if(frameSrc){e.setPage(cd.frame,frameSrc,cd)}}}}}function initCardOptionsAndPutIntoData(cd,i,frame,frameSrc,topCardDiv,path,isStartCard,bCreatCard,bReUse){cd.index=i,cd.path=path,cd.frameSrc=frameSrc,cd.frame=frame,cd.topCardDiv=topCardDiv,cd.bPullToEnd=false,cd.dataAndLoad=0,cd.dataRetryFlag=0;cd.topCardDiv.setAttribute("data-index",i);if(isStartCard){updateReaded(e.parentPath,i);if(e.hasShowCatalogCard){e.backCard=cd}else{e.card=cd}refreshControlStatus(path.level)}if(bCreatCard){if(isStartCard){putDataOrRequestData(cd,path,frameSrc)}else{setTimeout(function(){putDataOrRequestData(cd,path,frameSrc)},--e.cardLoadOrder*e.transTime)}}else{putDataOrRequestData(cd,path,frameSrc,bReUse)}}function swipeBackHandler(){e.contentDiv.removeEventListener("webkitTransitionEnd",swipeBackHandler);e.contentDiv.style[e.vendor+"TransitionDuration"]="300ms";e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+e.contentLeft+"px,0"+e.trnClose}function reBackCardPosition(el,time,left,lr){if(e.swipeWay){el.style[e.vendor+"TransitionDuration"]=time+"ms";el.style[e.vendor+"Transform"]=e.trnOpen+left+"px,0"+e.trnClose}else{el.style[e.vendor+"TransitionDuration"]="300ms";if(lr){el.style[e.vendor+"Transform"]=e.trnOpen+(e.contentLeft+80)+"px,0"+e.trnClose}else{el.style[e.vendor+"Transform"]=e.trnOpen+(e.contentLeft-80)+"px,0"+e.trnClose}el.addEventListener("webkitTransitionEnd",swipeBackHandler)}e.bEnableTouch=false;setTimeout(function(){el.style[e.vendor+"TransitionDuration"]=0;e.bEnableTouch=true},e.transTime)}function addWebTouchSwitchCardHandler(el){el.addEventListener(e.START_EV,function(evt){if(!e.bEnableTouch||e.hasShowCatalogCard||!_bLoadingEnd||e.dragFlag){return}evt=e.hasTouch?evt.touches[0]:evt;e.curStartLeft=evt.pageX,e.curStartTop=evt.pageY,e.dragFlag=false,e.hDirectionLock=false,e.vDirectionLock=false,e.contentDiv.style[e.vendor+"TransitionDuration"]=0;if(e.bEndFactor){if(e.card.index==0){e.slowFactor={l:1,r:0.4}}else{if(e.card.index==e.cardLength-1){e.slowFactor={l:0.4,r:1}}else{e.slowFactor={l:1,r:1}}}}else{e.slowFactor={l:1,r:1}}el.addEventListener(e.MOVE_EV,es_webMove);el.addEventListener(e.END_EV,es_webEnd)});function es_webMove(evt){evt=e.hasTouch?evt.touches[0]:evt;var moveLen=evt.pageX-e.curStartLeft;if(moveLen>0){var sf=e.slowFactor.r}else{var sf=e.slowFactor.l}var newPosX=e.contentLeft+moveLen*sf;if(e.dragFlag&&e.hDirectionLock){e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+newPosX+"px,0"+e.trnClose}else{if(!e.dragFlag&&!e.vDirectionLock&&!e.hDirectionLock){var moveLenY=evt.pageY-e.curStartTop,absLen=Math.abs(moveLen),absLenY=Math.abs(moveLenY),flag=absLen/absLenY>e.switchCardFactor?true:false;if(absLen>e.dragThreshold&&flag){e.hDirectionLock=true,e.vDirectionLock=false,e.dragFlag=true,e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+newPosX+"px,0"+e.trnClose}else{if(absLenY>e.dragThreshold&&!flag){e.hDirectionLock=false,e.vDirectionLock=true;if(e.bHighlightCtrl&&e.card.vScrollbarWrapper){highlightCtrlBar("rb");highlightCtrlBar("lb")}}}}}}function es_webEnd(evt){if(e.dragFlag){evt=e.hasTouch?evt.changedTouches[0]:evt;var threshold=evt.pageX-e.curStartLeft;setTimeout(function(){e.dragFlag=false;e.bEnableTouch=false;if(Math.abs(threshold)>e.carouselThreshold){if(threshold>0){cardSwipeRight()}else{cardSwipeLeft()}}else{reBackCardPosition(e.contentDiv,e.transTime,e.contentLeft)}},5)}el.removeEventListener(e.MOVE_EV,es_webMove);el.removeEventListener(e.END_EV,es_webEnd);el.removeEventListener(e.CANCEL_EV,es_webEnd)}}function addNativeTouchSwitchCardHandler(el){var START_EV="down",MOVE_EV="move",END_EV="up";el.addEventListener(START_EV,function(evt){e._tt=new Date;if(!e.bEnableTouch||e.hasShowCatalogCard||!_bLoadingEnd||e.dragFlag){return}evt=e.hasTouch&&!e.useNativeEventLyr?evt.touches[0]:evt;e.startFlag=true,e.hDirectionLock=false,e.vDirectionLock=false,e.dragFlag=false,e.curStartLeft=evt.pageX,e.curStartTop=evt.pageY,e.contentDiv.style[e.vendor+"TransitionDuration"]=0;if(e.bEndFactor){if(e.card.index==0){e.slowFactor={l:1,r:0.4}}else{if(e.card.index==e.cardLength-1){e.slowFactor={l:0.4,r:1}}else{e.slowFactor={l:1,r:1}}}}else{e.slowFactor={l:1,r:1}}function f(isFirst){var r=JSON.parse(es_toucheventgetvar.getPos());if(isFirst){e.timeF=null;e.x=e.lx=r.posx,e.y=e.ly=r.posy}else{e.x=r.posx,e.y=r.posy;if(Math.abs(e.x-e.lx)>e.cardWidth/100){es_nativeMove({pageX:r.posx,pageY:r.posy,time:(new Date-e._tt)});e.lx=r.posx,e.ly=r.posy}}e.timeF=setTimeout(f,60)}f(true);el.addEventListener(END_EV,es_nativeEnd)});function es_nativeMove(evt,time){evt=e.hasTouch&&!e.useNativeEventLyr?evt.touches[0]:evt,e.contentDiv.style[e.vendor+"TransitionDuration"]=time+"ms";var moveLen=evt.pageX-e.curStartLeft;if(moveLen>0){var sf=e.slowFactor.r}else{var sf=e.slowFactor.l}var newPosX=e.contentLeft+moveLen*sf/window.devicePixelRatio;if(e.dragFlag&&e.hDirectionLock){e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+newPosX+"px,0"+e.trnClose}else{if(!e.dragFlag&&!e.vDirectionLock&&!e.hDirectionLock){var moveLenY=evt.pageY-e.curStartTop,absLen=Math.abs(moveLen),absLenY=Math.abs(moveLenY),flag=absLen/absLenY>e.switchCardFactor?true:false;if(absLen>e.dragThreshold&&flag){e.hDirectionLock=true,e.vDirectionLock=false,e.dragFlag=true,e.contentDiv.style[e.vendor+"Transform"]=e.trnOpen+newPosX+"px,0"+e.trnClose}else{if(absLenY>e.dragThreshold&&!flag){e.hDirectionLock=false,e.vDirectionLock=true;if(e.bHighlightCtrl&&e.card.vScrollbarWrapper){highlightCtrlBar("rb");highlightCtrlBar("lb")}}}}}e._tt=new Date}function es_nativeEnd(evt){if(!e.bEnableTouch||e.hasShowCatalogCard){return}evt=e.hasTouch&&!e.useNativeEventLyr?evt.changedTouches[0]:evt;clearTimeout(e.timeF);es_nativeMove({pageX:evt.pageX,pageY:evt.pageY,time:evt.pageX-e.curStartLeft});if(e.dragFlag){e.dragFlag=false;var threshold=evt.pageX-e.curStartLeft;if(Math.abs(threshold)>e.carouselThreshold){e.bEnableTouch=false;if(threshold>0){cardSwipeRight()}else{cardSwipeLeft()}}else{reBackCardPosition(e.contentDiv,e.transTime,e.contentLeft)}}el.removeEventListener(END_EV,es_nativeEnd)}}function updateReaded(parentPath,curIndex){var dl=parentPath.dataList,num=0,lastnum=0;if(dl){for(var i=0;i<dl.length;i++){if(dl[i].data){lastnum=num,num+=dl[i].data.length;if(num>curIndex){dl[i].data[curIndex-lastnum].readed=true;return}}}}}$(window).hashchange(function(){var hash=window.location.hash;if(e.bHisToryButton){if(e.hash[1]=="s"&&e.hasShowCatalogCard){switchCatalogCard(e.catalogIndex,false,true)}else{goBack2ParentCard(e.card,true)}}e.bHisToryButton=true;e.hash=hash});$(window).hashchange()}(es));